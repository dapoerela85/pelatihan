---
layout: null
permalink: /modul/
---

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="/pelatihan/assets/manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Barjas 2025">
  <link rel="apple-touch-icon" href="/pelatihan/assets/icons/icon-152.png">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Try Out Pelatihan Kompetensi PBJ Level 1</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/pelatihan//assets/css/style.css">
</head>
<body>

<nav class="navbar fixed-top small rounded user-profile">
  <div class="container-fluid">
    <ul class="nav">
      <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="/pelatihan/modul/">
          <i class="bi bi-house"></i>
          <span class="nav-text">Beranda</span>
        </a>
      </li>
      <li id="user-profile-display" class="userProfileDisplay">
        <!-- Konten akan diisi oleh JavaScript -->
      </li>
      <li class="nav-item">
        <a class="nav-link" href="?view=notifications">
          <i class="bi bi-bell"></i>
          <span class="nav-text">Notifikasi</span>
          <span id="activeQuizzesBadge" class="badge bg-danger d-none">0</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" role="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">
          <i class="bi bi-three-dots-vertical"></i>
          <span class="nav-text">Menu</span>
        </a>
      </li>
    </ul>
  </div>
</nav>

<div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Menu</h5>
    <button type="button" class="btn-close shadow-none" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body fs-4">
<ul class="nav flex-column">
  <li class="nav-item">
    <a class="nav-link" href="/pelatihan/modul/"><i class="bi bi-house"></i> Beranda</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="?view=settings"><i class="bi bi-gear"></i> Pengaturan</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="?view=help"><i class="bi bi-question-circle"></i> Bantuan</a>
  </li>
  <li class="nav-item" id="installContainer" style="display: none;">
    <button id="installBtn" class="nav-link">
        <i class="bi bi-download"></i>
        <span class="nav-text">Install App</span>
    </button>
</li>
</ul>
  </div>
</div>

 <div class="container py-1" id="mainContainer">

    <!-- Main page -->
    <div id="mainPage" class="container text-center py-5" style="display: none;">
     <h2>Try Out Pelatihan Kompetensi PBJP</h2>
     <p>Uji pemahaman Anda tentang Pengadaan Barang dan Jasa Pemerintah.</p>
     <div class="list-group" id="quizList"></div>   
   </div>

    <!-- Landing Page Container -->
    <div id="landingPageContainer" class="py-5" style="display: none;"></div>

    <!-- Quiz Container -->
    <div id="quizContentContainer" class="py-5" style="display: none;"></div>

    <!-- Results Container -->
    <div id="resultContainer" class="result-container mt-0 mb-5 py-5" style="display: none;">
        <div id="noResultsAlert" class="card card-body d-none no-print text-center">
            <h3>Hasil Pencapaian</h3>
            <p class="no-print">Belum ada hasil yang tersimpan. Silahkan kerjakan soal terlebih dahulu.</p>
            <button id="startQuizBtn" class="btn btn-primary start-quiz-btn d-none">Mulai Sekarang</button>
        </div>
        <div id="resultSummary" class="mb-4"></div>
        <div id="answerList"></div>
    </div>

    <!-- 404 Page Not Found Container -->
    <div id="notFoundContainer" class="text-center py-5" style="display: none;">
        <div class="card shadow">
            <div class="card-body">
                <h1 class="display-1 text-danger">404</h1>
                <h2 class="mb-4">Halaman Tidak Ditemukan</h2>
                <p class="lead">Halaman yang Anda cari tidak/belum tersedia atau parameter URL tidak valid.</p>
                <a href="/pelatihan/modul/" class="btn btn-primary mt-3">
                    <i class="bi bi-house-door"></i> Kembali ke Beranda
                </a>
            </div>
        </div>
    </div>

<!-- Notifikasi -->
<div id="notificationsContainer" class="container py-5 m-0 p-0" style="display: none;">
  <div class="card shadow">
    <div class="card-header bg-primary text-white">
      <i class="bi bi-bell"></i> Notifikasi
    </div>
    <div class="card-body">
      <div id="activeQuizzesList">
        <div class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Memuat quiz aktif...</p>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Settings -->
<!-- Add this with your other containers -->
<div id="settingsContainer" class="container py-5" style="display: none;">
  <div class="card shadow">
    <div class="card-body">
      <h2 class="mb-4">Pengaturan</h2>
      
      <div class="alert alert-warning">
        <i class="bi bi-exclamation-triangle"></i> 
        Perubahan pengaturan akan mempengaruhi penyimpanan lokal di browser Anda.
      </div>
      
      <div class="card mb-4">
        <div class="card-header bg-danger text-white">
          <i class="bi bi-trash"></i> Hapus Data
        </div>
        <div class="card-body">
          <h5 class="card-title">Hapus Semua Data Penyimpanan Lokal</h5>
          <p class="card-text">
            Ini akan menghapus semua data yang tersimpan di browser Anda termasuk:
            <ul>
              <li>Jawaban ujian yang sudah/belum diselesaikan</li>
              <li>Hasil ujian sebelumnya</li>
              <li>Data profil pengguna</li>
              <li>Waktu pengerjaan</li>
            </ul>
          </p>
          <button id="clearAllDataBtn" class="btn btn-danger">
            <i class="bi bi-trash"></i> Hapus Semua Data
          </button>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header bg-primary text-white">
          <i class="bi bi-info-circle"></i> Informasi
        </div>
        <div class="card-body">
          <p class="card-text">
            Data disimpan secara lokal di browser Anda dan hanya dapat diakses oleh Anda pada perangkat yang sama.
          </p>
          <p class="card-text small text-muted">
            <i class="bi bi-lightbulb"></i> Tips: Gunakan tombol "Hapus Semua Data" jika Anda ingin memulai ulang dari awal atau berpindah perangkat.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bantuan -->
<div id="helpContainer" class="container py-5" style="display: none;">
  <div class="card shadow">
    <div class="card-body">
      <h2 class="mb-4">Help & FAQ</h2>
      
      <div class="accordion mb-3" id="helpAccordion">
        <!-- FAQ items will be inserted here -->
      </div>
      <div class="mt-4">
        <h4>Contact Support</h4>
        <p>Ada pertanyaan? atau web error? jangan sungkan hubungi kami.</p>
        <p>Email: saadahemail@gmail.com<br>Whatsapp: 0817-7997-7947</p>
      </div>
      
    </div>
  </div>
</div>

</div>


<!-- Universal Modal -->
<div class="modal fade" id="universalModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="universalModalTitle">Modal Title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="universalModalBody"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary" id="universalModalConfirmBtn">Konfirmasi</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Alert -->
<div id="alertBox" class="toast position-fixed bottom-0 end-0 m-3" role="alert" aria-live="assertive" aria-atomic="true" style="display: none;">
  <div class="toast-body text-white" id="alertMessage"></div>
</div>

<!-- Profile Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="profileModalLabel">Isi Data Profil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="profileForm">
                    <div class="mb-3">
                        <label for="modalNama" class="form-label">Nama</label>
                        <input type="text" class="form-control shadow-none" placeholder="Cth. Ela Susila" id="modalNama" required>
                    </div>
                    <div class="mb-3">
                        <label for="modalInstansi" class="form-label">Instansi</label>
                        <input type="text" placeholder="Cth. Dinkop UKM Tangsel" class="form-control shadow-none" id="modalInstansi">
                    </div>
                </form>
                <p class="small text-muted">
                    Data disimpan di Local Storage (penyimpanan lokal di browser) dan hanya dapat diakses oleh Anda 
                    dan hanya pada perangkat yang sama.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="saveProfileBtn">Simpan</button>
            </div>
        </div>
    </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/pelatihan/assets/js/user-profile.js"></script>
  <script src="/pelatihan/assets/js/sw.js"></script>

<script>
const APP_URLS = {
    HOME: '/pelatihan/modul/',
    NOTIFICATION: '?view=notifications',
    SETTINGS: '?view=settings',
    HELP: '?view=help'
};

const COMMON_QUIZ_CONFIG = {
  ELEMENT_IDS: {
    QUIZ_CONTAINER: "quizContainer",
    RESULT_CONTAINER: "resultContainer",
    LANDING_PAGE: "landingPage",
    QUESTION_TEXT: "questionText",
    OPTIONS_FORM: "optionsForm",
    CURRENT_QUESTION_NUMBER: "currentQuestionNumber",
    TOTAL_QUESTIONS: "totalQuestions",
    QUIZ_PROGRESS: "quizProgress",
    QUESTION_NUMBERS: "questionNumbers",
    PREV_BTN: "prevBtn",
    NEXT_BTN: "nextBtn",
    FINISH_BTN: "finishBtn",
    SKIP_BTN: "skipBtn",
    GIVE_UP_BTN: "giveUpBtn",
    START_QUIZ_BTN: "startQuizBtn",
    RESULT_SUMMARY: "resultSummary",
    ANSWER_LIST: "answerList",
    TIMER: "timer",
    ALERT_BOX: "alertBox",
    ALERT_MESSAGE: "alertMessage",
    QUESTION_POINTS: "questionPoints",
    LANDING_PAGE_CONTAINER: "landingPageContainer",
    NOT_FOUND_CONTAINER: "notFoundContainer",
    QUIZ_CONTENT_CONTAINER: "quizContentContainer",
    MAINPAGE: "mainPage",
    QUIZ_LIST: "quizList",
    NOT_FOUND_CONTAINER_ID: "notFoundContainerId",
    HOMEPAGE: "homepage",
    HELP_CONTAINER: "helpContainer",
    HELP_ACCORDION: "helpAccordion",
    NO_RESULT_ALERT: "noResultsAlert",
    STAT_QUIZ_BUTTON: "startQuizBtn",
    UNIVERSAL_MODAL: "universalModal",
    UNIVERSAL_MODAL_TITLE: "universalModalTitle",
    UNIVERSAL_MODAL_BODY: "universalModalBody",
    UNIVERSAL_MODAL_CONFIRM_BUTTON: "universalModalConfirmBtn",
    SETTINGS_CONTAINER: "settingsContainer",
    NOTIFICATIONS_CONTAINER: "notificationsContainer"
  },

  ELEMENT_TEXT: {
    BERANDA: "Beranda",
    MULAI_SEKARANG_BUTTON: "Mulai Sekarang",
    LIHAT_HASIL_BUTTON: "Lihat Hasil",
    JENIS_SOAL: "Jenis Soal",
    PILIHAN_GANDA: "Pilihan Ganda",
    JUMLAH_SOAL: "Jumlah Soal",
    WAKTU_PENGERJAAN: "120 Menit",
    NILAI: "Nilai",
    RESET: "Reset",
    SKOR: "Skor",
    STATUS: "Status",
    HASIL_SEBELUMNYA: "Hasil Sebelumnya",
    HASIL_PENCAPAIAN: "Hasil Pencapaian",
    TANGGAL_PENGERJAAN: "Tanggal Pengerjaan",
    WAKTU_PENGERJAAN: "Waktu Pengerjaan",
    WAKTU_TERSISA: "Waktu yang tersisa",
    WAKTU_DIHABISKAN: "Waktu yang dihabiskan",
    PASSING_GRADE: "Passing Grade",
    JUMLAH: "Jumlah",
    EDIT: "Edit",
    CETAK_HASIL: "Cetak Hasil",
    JAWABAN_BENAR: "Benar",
    JAWABAN_SALAH: "Salah",
    JAWABAN_DILEWATI: "Dilewati",
    GRADE: "Grade",
    NILAI_MINIMAL_LULUS: "Nilai Minimal Kelulusan",
    NILAI_MAKSIMAL_LULUS: "Nilai Maksimal Kelulusan",
    INFO: "Info",
    MENGERTI: "Mengerti",
    POIN: "Poin",
    SOAL: "Soal",
    LANJUTKAN_KUIS: "Lanjutkan",
    BATALKAN_KUIS: "Batalkan",
    ACTIVE_QUIZZESS_LIST: "activeQuizzesList",
    NO_NOTIFICATION: "Tidak ada notifkasi"
  }
};

// Quiz Config
const QUIZ_CONFIGS = {
  'pretest': {
    STORAGE_KEY: "pretest",
    QUIZ_TITLE: "Try Out Pelatihan Kompetensi FBJ Level 1 Modul 1 (Pre Test)",
    READY: true,
    QUIZ_URL: "?id=pretest",
    HOMEPAGE_URL: "/pelatihan/modul/",
    SUMBER_SOAL: "",
    DURATION: 20 * 60 * 1000,   // 120 minutes in milliseconds
    QUESTION_COUNT: 20,
    SCORING_RULES: {
      DEFAULT_SCORE: 1,
      RANGES: [
        { from: 1, to: 20, score: 1 }
      ]
    },
    MAX_SCORE: 100,
    PASSING_SCORE: 80,
    PASSING_GRADE: "C",
    KEYS: {
      START_TIME: "startTime",
      END_TIME: "endTime",
      USER_ANSWERS: "userAnswers",
      RESULTS: "results",
      CURRENT_QUESTION: "currentQuestion"
    },
    TIMER: {
      INTERVAL: 1000, // 1 detik
      ALERT_THRESHOLD: 5 * 60 * 1000 // 5 menit sebelum habis
    }
  },

  'modul2': {
    STORAGE_KEY: "modul_2",
    QUIZ_TITLE: "Try Out Pelatihan Kompetensi FBJ Level 1 Modul 2",
    READY: true,
    QUIZ_URL: "?id=modul2",
    HOMEPAGE_URL: "/pelatihan/modul/",
    SUMBER_SOAL: "",
    DURATION: 20 * 60 * 1000,   // 120 minutes in milliseconds
    QUESTION_COUNT: 15,
    SCORING_RULES: {
      DEFAULT_SCORE: 1,
      RANGES: [
        { from: 1, to: 15, score: 1 }
      ]
    },
    MAX_SCORE: 100,
    PASSING_SCORE: 80,
    PASSING_GRADE: "C",
    KEYS: {
      START_TIME: "startTime",
      END_TIME: "endTime",
      USER_ANSWERS: "userAnswers",
      RESULTS: "results",
      CURRENT_QUESTION: "currentQuestion"
    },
    TIMER: {
      INTERVAL: 1000, // 1 detik
      ALERT_THRESHOLD: 5 * 60 * 1000 // 5 menit sebelum habis
    }
  },

  'modul3': {
    STORAGE_KEY: "modul_3",
    QUIZ_TITLE: "Try Out Pelatihan Kompetensi FBJ Level 1 Modul 3",
    READY: true,
    QUIZ_URL: "?id=modul3",
    HOMEPAGE_URL: "/pelatihan/modul/",
    SUMBER_SOAL: "",
    DURATION: 20 * 60 * 1000,   // 120 minutes in milliseconds
    QUESTION_COUNT: 15,
    SCORING_RULES: {
      DEFAULT_SCORE: 1,
      RANGES: [
        { from: 1, to: 15, score: 1 }
      ]
    },
    MAX_SCORE: 100,
    PASSING_SCORE: 80,
    PASSING_GRADE: "C",
    KEYS: {
      START_TIME: "startTime",
      END_TIME: "endTime",
      USER_ANSWERS: "userAnswers",
      RESULTS: "results",
      CURRENT_QUESTION: "currentQuestion"
    },
    TIMER: {
      INTERVAL: 1000, // 1 detik
      ALERT_THRESHOLD: 5 * 60 * 1000 // 5 menit sebelum habis
    }
  },

  'modul4': {
    STORAGE_KEY: "modul_4",
    QUIZ_TITLE: "Try Out Pelatihan Kompetensi FBJ Level 1 Modul 4",
    READY: true,
    QUIZ_URL: "?id=modul4",
    HOMEPAGE_URL: "/pelatihan/modul/",
    SUMBER_SOAL: "",
    DURATION: 20 * 60 * 1000,   // 120 minutes in milliseconds
    QUESTION_COUNT: 15,
    SCORING_RULES: {
      DEFAULT_SCORE: 1,
      RANGES: [
        { from: 1, to: 15, score: 1 }
      ]
    },
    MAX_SCORE: 100,
    PASSING_SCORE: 80,
    PASSING_GRADE: "C",
    KEYS: {
      START_TIME: "startTime",
      END_TIME: "endTime",
      USER_ANSWERS: "userAnswers",
      RESULTS: "results",
      CURRENT_QUESTION: "currentQuestion"
    },
    TIMER: {
      INTERVAL: 1000, // 1 detik
      ALERT_THRESHOLD: 5 * 60 * 1000 // 5 menit sebelum habis
    }
  },

  'modul5': {
    STORAGE_KEY: "modul_5",
    QUIZ_TITLE: "Try Out Pelatihan Kompetensi FBJ Level 1 Modul 5",
    READY: true,
    QUIZ_URL: "?id=modul5",
    HOMEPAGE_URL: "/pelatihan/modul/",
    SUMBER_SOAL: "",
    DURATION: 20 * 60 * 1000,   // 120 minutes in milliseconds
    QUESTION_COUNT: 15,
    SCORING_RULES: {
      DEFAULT_SCORE: 1,
      RANGES: [
        { from: 1, to: 15, score: 1 }
      ]
    },
    MAX_SCORE: 100,
    PASSING_SCORE: 80,
    PASSING_GRADE: "C",
    KEYS: {
      START_TIME: "startTime",
      END_TIME: "endTime",
      USER_ANSWERS: "userAnswers",
      RESULTS: "results",
      CURRENT_QUESTION: "currentQuestion"
    },
    TIMER: {
      INTERVAL: 1000, // 1 detik
      ALERT_THRESHOLD: 5 * 60 * 1000 // 5 menit sebelum habis
    }
  },

  'modul6': {
    STORAGE_KEY: "modul_6",
    QUIZ_TITLE: "Try Out Pelatihan Kompetensi FBJ Level 1 Modul 6",
    READY: true,
    QUIZ_URL: "?id=modul6",
    HOMEPAGE_URL: "/pelatihan/modul/",
    SUMBER_SOAL: "",
    DURATION: 20 * 60 * 1000,   // 120 minutes in milliseconds
    QUESTION_COUNT: 15,
    SCORING_RULES: {
      DEFAULT_SCORE: 1,
      RANGES: [
        { from: 1, to: 15, score: 1 }
      ]
    },
    MAX_SCORE: 100,
    PASSING_SCORE: 80,
    PASSING_GRADE: "C",
    KEYS: {
      START_TIME: "startTime",
      END_TIME: "endTime",
      USER_ANSWERS: "userAnswers",
      RESULTS: "results",
      CURRENT_QUESTION: "currentQuestion"
    },
    TIMER: {
      INTERVAL: 1000, // 1 detik
      ALERT_THRESHOLD: 5 * 60 * 1000 // 5 menit sebelum habis
    }
  },

  'modul7': {
    STORAGE_KEY: "modul_7",
    QUIZ_TITLE: "Try Out Pelatihan Kompetensi FBJ Level 1 Modul 7 (MRP)",
    READY: true,
    QUIZ_URL: "?id=modul7",
    HOMEPAGE_URL: "/pelatihan/modul/",
    SUMBER_SOAL: "",
    DURATION: 20 * 60 * 1000,   // 120 minutes in milliseconds
    QUESTION_COUNT: 15,
    SCORING_RULES: {
      DEFAULT_SCORE: 1,
      RANGES: [
        { from: 1, to: 15, score: 1 }
      ]
    },
    MAX_SCORE: 100,
    PASSING_SCORE: 80,
    PASSING_GRADE: "C",
    KEYS: {
      START_TIME: "startTime",
      END_TIME: "endTime",
      USER_ANSWERS: "userAnswers",
      RESULTS: "results",
      CURRENT_QUESTION: "currentQuestion"
    },
    TIMER: {
      INTERVAL: 1000, // 1 detik
      ALERT_THRESHOLD: 5 * 60 * 1000 // 5 menit sebelum habis
    }
  }

};

// Questions
const QUIZ_QUESTIONS = {
  // Pre test
  'pretest': [
    {
      question: "Segmen manajemen rantai pasok terbagi atas beberapa bagian. Segmen berikut yang BUKAN termasuk segmen manajemen rantai pasok yaitu...",
      options: [
        "A. Rantai pasok hilir (Downstream Supply Chain)",
        "B. Rantai pasok distribusi (Distribution Supply Chain)",
        "C. Rantai pasok internal (Internal Supply Chain)",
        "D. Rantai pasok hulu (Upstream Supply Chain)"
      ],
      answer: "B"
    },
    {
      question: "Pembentukan UKPBJ kota XYZ secara struktural dengan nomenklatur berdasarkan kebutuhan dan sesuai ketentuan peraturan perundang-undangan dilakukan oleh...",
      options: [
        "A. Kuasa Pengguna Anggaran",
        "B. Pengguna Anggaran",
        "C. Kepala Daerah",
        "D. Pejabat Pembuat Komitmen"
      ],
      answer: "C"
    },
    {
      question: "Pokja pemilihan akan menetapkan metode pemilihan yang digunakan untuk pengadaan pembangunan gedung sederhana dengan nilai Rp 300 Juta dimana spesifikasi dan volumenya sudah dapat ditentukan secara rinci dan pelaku usahanya telah terkualifikasi dalam sistem informasi kinerja penyedia (SIKAP). Metode pemilihan yang digunakan yaitu...",
      options: [
        "A. Seleksi",
        "B. Tender Cepat",
        "C. Penunjukan Langsung",
        "D. Pengadaan Langsung"
      ],
      answer: "B"
    },
    {
      question: "Mengindetifikasi pelaksana pekerjaan sesuai dengan karakteristik barang/jasa pada saat perencanaan merupakan upaya penanganan risiko pada tahapan...",
      options: [
        "A. Penyusunan harga perkiraan",
        "B. Penetapan cara pengadaan",
        "C. Penyusunan spesifikasi teknis",
        "D. Penetapan jenis barang/jasa"
      ],
      answer: "B"
    },
    {
      question: "Memastikan bahwa sasaran atau target yang ditetapkan di dalam kontrak pengadaan barang/jasa akan tercapai sesuai yang direncanakan merupakan tujuan dari...",
      options: [
        "A. Evaluasi kinerja penyedia",
        "B. Perumusan kontrak",
        "C. Pengendalian kontrak",
        "D. Serah terima barang"
      ],
      answer: "C"
    },
    {
      question: "Strategi pengadaan yang dapat dikembangkan dari kebijakan memberikan kesempatan kepada usaha mikro, kecil dan koperasi (UMKK) yaitu...",
      options: [
        "A. Mempertimbangkan nilai TKDN dan nilai BMP",
        "B. Mengalokasikan paling sedikit 40% dari nilai anggaran belanja barang/jasa untuk UMKK dengan produksi dalam negeri",
        "C. Meningkatkan kesadaran potensi industri kreatif",
        "D. Pemamfaatan katalog elektronik sektoral"
      ],
      answer: "B"
    },
    {
      question: "Salah satu risiko dalam serah terima hasil pengadaan pada pekerjaan pembangunan ruang kelas baru (RKB) sekolah dasar negeri 2 kota PQR dengan HPS senilai Rp 1,2 Miliar yaitu keterlambatan serah terima hasil pekerjaan. Penanganan yang dapat dilakukan terhadap risiko tersebut yaitu...",
      options: [
        "A. Mengenakan sanksi ganti rugi kepada penyedia",
        "B. Mengenakan saksi keterlambatan kepada penyedia",
        "C. Meningkatkan kompetensi tentang evaluasi kinerja penyedia bagi pejabat penandatanganan kontrak",
        "D. Memberikan surat pemberitahuan kepada penyedia untuk mengganti dengan barang/jasa yang sesuai"
      ],
      answer: "B"
    },
    {
      question: "Berdasarkan pasal 1320 KUH Perdata, suatu perjanjian dikatakan sah apabila memenuhi syarat antara lain sebagai berikut...",
      options: [
        "A. Tidak berdasarkan hal tertentu",
        "B. Kecakapan untuk membuat suatu perikatan",
        "C. Kedua belah pihak tidak sepakat untuk melakukan perikatan",
        "D. Suatu sebab dinyatakan haram"
      ],
      answer: "B"
    },
    {
      question: "Pengadaan kapal dengan metode pemilihan e-purchasing yang akan dibagikan nelayan termasuk jenis pengadaan...",
      options: [
        "A. Jasa konsultasi",
        "B. Pekerjaan konstruksi",
        "C. Barang",
        "D. Jasa lainnya"
      ],
      answer: "C"
    },
    {
      question: "Berikut ini yang perlu diperhatikan dalam melakukan reviu spesifikasi teknis/KAK yaitu ketentuan mengenai...",
      options: [
        "A. Penyesuaian harga",
        "B. Denda keterlambatan",
        "C. Pemberian uang muka",
        "D. Tingkat Komponen Dalam Negeri (TKDN)"
      ],
      answer: "D"
    },
    {
      question: "Penyusunan perencanaan panegadaan pada kemeterian XYZ dilaksanakan bersamaan dnegan pembahasan...",
      options: [
        "A. UU APBN dan Alokasi Anggaran",
        "B. DIPA dan Pemutakhiran RKP",
        "C. Rancangan Awal RKP dan SB Pagu Indikatif",
        "D. RUU APBN dan Nota Keuangan"
      ],
      answer: "D"
    },
    {
      question: "Komposisi biaya langsung personel dan biaya lansgung non personel terhadap total biaya pada pengadaan jasa konsultasi yaitu...",
      options: [
        "A. Paling sedikit 40%, tidak melebihi 60%",
        "B. Paling sedikit 60%, tidak melebihi 40%",
        "C. Paling sedikit 20%, tidak melebihi 80%",
        "D. Paling sedikit 30%, tidak melebihi 70%"
      ],
      answer: "B"
    },
    {
      question: "Berikut ini yang TIDAK sesuai dengan penerapan etika pengadaan yang dilaksanakan oleh pokja pemilihan yaitu...",
      options: [
        "A. Menjadi pengurus koperasi/perusahaan dan bertindak sebagai pokja pada paket yang sama",
        "B. Tidak menerima uang dari penyedia agar ditunjuk sebagai pemenang pemilihan",
        "C. Tidak memaksakan calon penyedia yang tidak profesional dan yang memiliki hubungan kekerabatan dnegan pokja untuk dimenangkan pada proses pemilihan",
        "D. Bersikap profesional dan mandiri dalam melakasanakan proses pemilihan"
      ],
      answer: "A"
    },
    {
      question: "Salah satu tugas tim persiapan pada swakelola pelatihan teknologi tepat guna yang dilaksanakan olek kelompok masyarakat desa XYZ yaitu melakukan reviu...",
      options: [
        "A. Dokumen penetapan tipe swakelola",
        "B. Proposal tim pelaksana",
        "C. Rancangan kontrak",
        "D. Rencana dan jadwal kegiatan"
      ],
      answer: "B"
    },
    {
      question: "Pengadaan barang/jasa dibawah ini yang TIDAK dapat menyebutkan merk dalam penyusunan spesifikasi teknisnya yaitu...",
      options: [
        "A. Pengadaan cartridge untuk printer EFG",
        "B. Pengadaan server melalui e-purchasing",
        "C. Pnegadaan kapal perikanan 5GT",
        "D. Penggantian bagian automatic rescue device (ARD) pada lift"
      ],
      answer: "C"
    },
    {
      question: "Salah satu perbedaan ketentuan dalam pelaksanaan swakelola tipe I dan swakelola tipe IV yaitu mengenai...",
      options: [
        "A. Cara pembayaran",
        "B. Pihak yang menerima laporan",
        "C. Serah terima pekerjaan",
        "D. Sanksi"
      ],
      answer: "D"
    },
    {
      question: "Dinas pemuda dan olahraga provinsi XYZ melaksankana pengadaan makan minum untuk kegiatan rapat. kegiatan pengadaan barang/jasa tersebut termasuk jenis kegiatan...",
      options: [
        "A. PBJP Tanggap Darurat",
        "B. PBJP Rutin",
        "C. PBJP proyek",
        "D. PBJP Internasional"
      ],
      answer: "B"
    },
    {
      question: "Negosiasi dalam pengadaan barang/jasa pemerintah TIDAK dapat dilakukan oleh pokja pemilihan atau pejabat pengadaan pada...",
      options: [
        "A. Seleksi penyedia jasa konsultasi",
        "B. Tender dengan jumlah peserta yang memasukan penawaran dan lulus evaluasi teknis hanya 1 (satu) peserta",
        "C. Tender pekerjaan konstruksi dnegan peserta memasukan penawaran lebih dari 1 (satu) dan tidak ada yang lulus persyaratan",
        "D. Penunjukan langsung dan pengadaan langsung dengan bentuk surat perintah kerja"
      ],
      answer: "C"
    },
    {
      question: "PPK dalam pelaksanaan kontrak paket pembangunan jembatan sungai waringin menerima hadiah sebesar Rp 300 Juta rupiah dari poenyedia. Tindakan PPK dalam menerima hadiah tersebut merupakan salah satu bentuk pelanggaran dalam aspek hukum...",
      options: [
        "A. Tata Usaha Negara",
        "B. Pidana",
        "C. Perdata",
        "D. Administrasi Negara"
      ],
      answer: "B"
    },
    {
      question: "Penetapan pemenang dalam pelaksanaan pemilihan melalui penyedia untuk perencanaan pembangunan jembatan dengan nilai HPS sebesar Rp 15 Miliar dilakukan oleh...",
      options: [
        "A. Kepala UKPBJ",
        "B. PPK",
        "C. PA",
        "D. Pokja Pemilihan"
      ],
      answer: "C"
    }
  ],

  // Modul 2
  'modul2': [
    {
      question: "Proses pemilihan penyedia konstruksi pembangunan jalan Melati di Kabupaten ABC senilai Rp500 Juta dilaksanakan oleh...",
      options: [
        "A. PP",
        "B. PPK",
        "C. Pokja Pemilihan",
        "D. PPTK"
      ],
      answer: "C"
    },
    {
      question: "PPK bersengketa dengan Penyedia tentang hasil pekerjaan yang terdapat dalam kontrak. Sengketa yang terjadi tersebut dalam pengadaan barang/jasa masuk aspek hukum...",
      options: [
        "A. Perdata",
        "B. Pidana",
        "C. Tindak Pidana Korupsi",
        "D. Hukum Administrasi Negara"
      ],
      answer: "A"
    },
    {
      question: "Pengadaan barang/jasa adalah kegiatan pengadaan barang/jasa oleh Kementerian/Lembaga/Perangkat Daerah/Instansi Lainnya/Pemerintah Desa yang dibiayai oleh APBN/APBD/APB Des yang prosesnya sejak...",
      options: [
        "A. Identifikasi kebutuhan sampai dengan pembayaran",
        "B. Proses pemilihan penyedia dan pengelolaan swakelola",
        "C. Identifikasi kebutuhan sampai dengan serah terima hasil pekerjaan",
        "D. Serah terima pekerjaan sampai dengan identifikasi kebutuhan"
      ],
      answer: "C"
    },
    {
      question: "Cara penyedia konstruksi dari kabupaten ABC yang memenuhi persyaratan dengan mengikuti tender yang dilaksanakan di propinsi XYZ. Hasil ini sesuai dengan prinsip pengadaan barang/jasa...",
      options: [
        "A. Efektif",
        "B. Transparan",
        "C. Efisien",
        "D. Terbuka"
      ],
      answer: "D"
    },
    {
      question: "Pengadaan bibit tanaman termasuk jenis pengadaan...",
      options: [
        "A. Jasa lainnya",
        "B. Pekerjaan konstruksi",
        "C. Barang",
        "D. Jasa konsultasi"
      ],
      answer: "C"
    },
    {
      question: "Berikut ini contoh penerapan kebijakan memperkuat kapasitas kelembagaan dan sumber daya manusia pengadaan barang dan jasa yang tepat yaitu...",
      options: [
        "A. Pembagian kerja pokja pemilihan lebih diarahkan kepada senioritas dalam jabatan",
        "B. Kebijakan mewajibkan personil pengadaan barang dan jasa untuk membeli barang dengan TKDN paling tinggi. Ulasan jawaban memahami kebijakan Pengadaan Barang/Jasa",
        "C. Kepala UKPBJ menyusun rencana anggaran pelatihan personil UKPBJ dalam satu tahun anggaran",
        "D. Kepala UKPBJ mendelegasikan tugas pokja pemilihan kepada staf yang belum memiliki kompetensi pengadaan barang/jasa"
      ],
      answer: "C"
    },
    {
      question: "Pejabat Fungsional Pengadaan Barang/Jasa tidak dapat diberikan tugas...",
      options: [
        "A. Membantu PA/KPA",
        "B. Sebagai Penyedia",
        "C. Sebagai PPK",
        "D. Sebagai Pejabat Pengadaan"
      ],
      answer: "B"
    },
    {
      question: "Pelaku Pengadaan yang memiliki tugas menetapkan dan mengumumkan RUP pada tahap perencanaan pengadaan yaitu...",
      options: [
        "A. PA",
        "B. Admin RUP",
        "C. PPK",
        "D. Pojka Pemilihan"
      ],
      answer: "A"
    },
    {
      question: "Dinas Penanaman Modal Kabupaten ABC akan melakukan mobil pajak keliling dengan nilai Rp 300 Juta melalui e-Purchasing. Proses pengadaan tersebut dilaksanakan oleh...",
      options: [
        "A. PP",
        "B. PPK",
        "C. Pokja Pemilihan",
        "D. PPTK"
      ],
      answer: "B"
    },
    {
      question: "Berikut ini merupakan implementasi kebijakan yang tepat dilaksanakan oleh Organisasi Perangkat Daerah (OPD) maupun Satuan Kerja (Satker) untuk meningkatkan peranan usaha kecil yaitu...",
      options: [
        "A. Membagi paket pengadaan barang dan jasa kepada pelaku usaha besar",
        "B. Menggunakan konsultan asing untuk kegiatan pemberdayaan",
        "C. Memperbanyak paket pengadaan barang/jasa kepada usaha kecil yang terdapat di katalog lokal",
        "D. Memesan barang impor dengan spesifikasi yang sangat berkualitas"
      ],
      answer: "C"
    },
    {
      question: "Kementerian XYZ akan melakukan pengadaan printer dengan nilai Rp 150 Juta. Proses pemilihan penyedia dilaksanakan oleh...",
      options: [
        "A. Pokja Pemilihan",
        "B. Pejabat Pengadaan",
        "C. PPK",
        "D. PPTK"
      ],
      answer: "B"
    },
    {
      question: "Pemerintah melaksanakan pengadaan transportasi massal dengan membeli bus dengan kapasitas 33 orang bermerek ABC karena terbukti kehandalannya. Hal ini sesuai dengan tujuan pengadaan barang/jasa yang tepat dari setiap uang yang dibelanjakan diukur dari aspek...",
      options: [
        "A. Kuantitas",
        "B. Waktu",
        "C. Kualitas",
        "D. Biaya"
      ],
      answer: "C"
    },
    {
      question: "Apabila penyedia terlambat menyelesaikan pekerjaan sesuai dengan kontrak, maka pengenaan sanksi berupa denda keterlambatan yang diberikan yaitu...",
      options: [
        "A. Denda keterlambatan sebesar 1% (permil) dari nilai kontrak atau nilai bagian kontrak untuk setiap hari keterlambatan (termasuk PPN)",
        "B. Denda keterlambatan sebesar 1% (permil) dari nilai keuntungan atau nilai bagian keuntungan untuk setiap hari keterlambatan (termasuk PPN)",
        "C. Denda keterlambatan sebesar 1% (permil) dari nilai kontrak atau nilai bagian kontak untuk setiap hari keterlambatan (termasuk PPN dan PPh)",
        "D. Denda keterlambatan sebesar 1% (permil) dari nilai kontrak atau nilai bagian kontrak untuk setiap hari keterlambatan (tidak termasuk PPN)"
      ],
      answer: "D"
    },
    {
      question: "Berikut ini yang BUKAN merupakan contoh pertentangan kepentingan pengadaan barang/jasa yaitu...",
      options: [
        "A. Konsultan manajemen konstruksi berperan sebagai konsultan perencana",
        "B. Direksi PT. A merupakan Tenaga Ahli PT. B yang sama-sama mengikuti tender pakey X di Kementerian Y",
        "C. Konsultan pengawas dan pelaksana dilaksanakan oleh perusahaan dan kepengurusan yang berbeda",
        "D. Konsultan pengawas bertindak sebagai pelaksana pada pekerjaan konstruksi"
      ],
      answer: "C"
    },
    {
      question: "Fungsi Layanan Pengadaan Secara Elektronik (LPSE) yaitu...",
      options: [
        "A. Menetapkan pemenang pemilihan",
        "B. Melaksanakan e-purchasing",
        "C. Melakukan registrasi dan verifikasi pengguna SPSE",
        "D. Melakukan penilaian kinerja penyedia"
      ],
      answer: "C"
    }
  ],

  // Modul 3
  'modul3': [
    {
      question: "Dasar untuk menetapkan batas tertinggi penawaran pada tender pengadaan benih ikan kerapu yaitu...",
      options: [
        "A. Rencana Anggaran Biaya",
        "B. Harga Prakiraan Sendiri",
        "C. Pagu Anggaran",
        "D. Harga Pasar"
      ],
      answer: "B"
    },
    {
      question: "Pengadaan barang/jasa dibawah ini yang TIDAK dapat menyebutkan merk dalam penyusunan spesifikasi teknisnya yaitu...",
      options: [
        "A. Pengadaan kapal perikanan 5GT",
        "B. Pengadaan server melalui e-purchasing",
        "C. Pergantian bagian automatic rescue device [ARD] pada lift",
        "D. Pengadaan cartridge untuk printer EFG"
      ],
      answer: "A"
    },
    {
      question: "Spesifikasi yang digunakan untuk memperkirakan kecenderungan kebutuhan barang/jasa di masa datang berdasarkan penggunaan di masa lalu yaitu...",
      options: [
        "A. Spesifikasi Jumlah",
        "B. Spesifikasi Komposisi",
        "C. Spesifikasi Pelayanan",
        "D. Spesifikasi Kualitas"
      ],
      answer: "A"
    },
    {
      question: "Skenario: Untuk mencapai output Dinas Kelautan dan Perikanan Provinsi B memberikan bantuan berupa mesin pakan dan mesin pelet sebanyak 50 unit. <br> Instruksi: Data yang diperlukan sebagai sumber informasi pada tahapan penetapan jenis pengadaan barang/jasa untuk paket pengadaan tersebut adalah...",
      options: [
        "A. RKBU",
        "B. KBU",
        "C. Katalog Elektronik",
        "D. KBKI"
      ],
      answer: "D"
    },
    {
      question: "Tahun 2023, Dinas Kelautan dan Perikanan Provinsi B merencanakan kegiatan pemberdayaan masyarakat pesisir dan pulau-pulau kecil di Kabupaten B. Strategi pengadaan yang tepat dalam meningkatkan pengadaan berkelanjutan yaitu...",
      options: [
        "A. Pengadaan mesin press plastik dengan tenaga surya/matahari",
        "B. Mengalokasikan 40% anggaran belanja kepada Usaha Menengah untuk pengadaan mesin press plastik",
        "C. Pengadaan mesin press plastik melalui impor",
        "D. Pengadaan mesin press plastik melalui e-katalog"
      ],
      answer: "A"
    },
    {
      question: "Skenario: PPK di Instansi Saudara sedang menyusun dokumen perencanaan pengadaan dan telah selesai melakukan penetapan jenis barang/jasa. Selanjutnya PPK akan menetapkan cara pengadaan untuk masing-masing kebutuhan barang/jasa tersebut. <br> Instruksi: Saudara diminta untuk membantu PPK mengumpulkan bahan data/informasi yang akan di gunakan olek PPK untuk menetapkan cara pengadaan. Selain spesifikasi teknis/KAK, bahan data/informasi yang dapat Saudara berikan kepada PPK yaitu...",
      options: [
        "A. Tipe/Merk barang/jasa",
        "B. Harga satuan barang/jasa",
        "C. Kelompok Pelaku Usaha",
        "D. Ketentuan klasifikasi barang/jasa"
      ],
      answer: "C"
    },
    {
      question: "Konsolidasi pengadaan barang/jasa pada tahap persiapan pengadaan dilakukan oleh...",
      options: [
        "A. Unit Kerja Pengadaan Barang/Jasa",
        "B. Pengguna Anggaran",
        "C. Pejabat Pembuat Komitmen",
        "D. Kuasa Pengguna Anggaran"
      ],
      answer: "C"
    },
    {
      question: "Tahun 2023, Dinas Pariwisata akan melaksanakan pemeliharaan bangunan kantor tetapi tidak tersedia anggaran jasa konsultan perencanaan. Dengan keterbatasan anggaran dan mengurangi risiko HPS yang kemahalan maka yang dilakukan oleh PA yaitu...",
      options: [
        "A. Menunjuk tenaga ahli untuk survei anggaran biaya pemeliharaan",
        "B. Menetapkan Tim Teknis untuk menghitung anggaran biaya pemeliharaan dengan melibatkan personil dari Dinas Pekerjaan Umum",
        "C. Menetapkan Tim Ahli untuk menghitung anggaran biaya pemeliharaan dengan melibatkan personil dari Dinas Pekerjaan Umum",
        "D. Menetapkan Tim Pendukung untuk menghitung anggaran biaya pemeliharaan dengan melibatkan personil dari Dinas Pekerjaan Umum"
      ],
      answer: "B"
    },
    {
      question: "Penyusunan perencanaan pengadaan pada Kementerian ABC dilaksanakan bersamaan dengan pembahasan...",
      options: [
        "A. UU APBN dan Alokasi Anggaran",
        "B. RUU APBN dan Nota Keuangan",
        "C. DIPA dan Pemutakhiran RKP",
        "D. Rancangan Awal RKP dan SB Pagu Indikatif"
      ],
      answer: "B"
    },
    {
      question: "Salah satu strategi pengadaan yang dapat dikembangkan dari kebijakan memberikan kesempatan kepada Usaha Mikro, Kecil, serta Koperasi yaitu...",
      options: [
        "A. Mengalokasikan paling sedikit 40% dari nilai anggaran belanja barang/jasa untuk produk usaha kecil",
        "B. Pemanfaatan katalog elektronik sektoral",
        "C. Meningkatkan kesadaran potensi industri kreatif",
        "D. Mempertimbangkan nilai TKDN dan nilai BMP"
      ],
      answer: "A"
    },
    {
      question: "Berikut ini, paket pengadaan jasa konsultasi yang dialokasikan untuk usaha kecil yaitu...",
      options: [
        "A. Pengadaan Jasa Konsultasi Perencanaan stadion olahraga senial Rp 1,2 Miliar",
        "B. Pengadaan Jasa Konsultasi Perencanaan gedung kantor 10 lantai senilai lebih Rp 2,5 Miliar",
        "C. Pengadaan Jasa Konsultasi Pengawasan Pembangunan Gedung Arsip senial Rp 289 Juta",
        "D. Pengadaan Jasa Konsultasi Manajemen Konstruksi senilai Rp 3 Miliar"
      ],
      answer: "C"
    },
    {
      question: "Metode pelaksanaan pekerjaan pembangunan gedung sekolah tercantum dalam...",
      options: [
        "A. Spesifikasi Mutu",
        "B. Spesifikasi Jumlah",
        "C. Spesifikasi Waktu",
        "D. Spesifikasi Layanan"
      ],
      answer: "A"
    },
    {
      question: "Bagian/sub bagian pada UKPBJ yang melaksanakan funsgi pengelolaan sistem informasi pengadaan barang/jasa beserta infrastrukturnya yaitu...",
      options: [
        "A. Pembinaan sumber daya manusia dan kelembagaan pengadaan barang/jasa",
        "B. Pengelolaan pengadaan barang/jasa",
        "C. Pendampingan, konsultasi dan bimbingan teknis pengadaan barang/jasa",
        "D. Pengelolaan layanan pengadaan secara elektronik"
      ],
      answer: "D"
    },
    {
      question: "Penyebutan merek yang TIDAK dimungkinkan dalam penyusunan spesifikasi teknis/KAK terhadap...",
      options: [
        "A. Jasa pemeliharaan mesin",
        "B. Komponen barang/jasa",
        "C. Bagian dari sistem yang sudah ada",
        "D. Suku cadang"
      ],
      answer: "A"
    },
    {
      question: "Batas akhir Penetapan HPS pada Pengadaan Pemeliharaan Pelabuhan Perikanan Pantai senilai Rp 250 Juta yaitu...",
      options: [
        "A. Paling lama 28 (dua puluh delapan) hari kerja sebelum batas akhir Pemasukan dokumen kualifikasi",
        "B. Paling lama 28 (dua puluh delapan) hari kalender sebelum batas akhir Pemasukan penawaran",
        "C. Paling lama 28 (dua puluh delapan) hari kerja sebelum batas akhir Pemasukan penawaran",
        "D. Paling lama 28 (dua puluh delapan) hari kalender sebelum batas akhir Pemasukan dokumen kualifikasi"
      ],
      answer: "C"
    }
  ],

  // Modul 4
  'modul4': [
    {
      question: "Pokja Pemilihan akan menetapkan Metode Pemilihan yang digunakan untuk pengadaan kendaraan dengan nilai Rp 850 juta dimana spesifikasi dan volumenya sudah dapat ditentukan secara rinci dan Pelaku Usahanya telah terkualifikasi dalam Sistem Informasi Kinerja Penyedia (SIKAP). Metode Pemilihan yang digunakan yaitu...",
      options: [
        "A. Seleksi",
        "B. Pengadaan Langsung",
        "C. Tender Cepat",
        "D. Penunjukan Langsung"
      ],
      answer: "C"
    },
    {
      question: "Skenario: Pokja Pemilihan akan melakukan reviu terhadap dokumen persiapan untuk pengadaanmeubelair di Bagian Umum Kota ABC dnegan nila Rp 250 Juta. <br> Instruksi: Saudara sebagai Pokja Pemilihan ditugaskan untuk melakukan reviu dokumen persiapan paket pekerjaan meubelair senilai Rp 300 Juta. Bahan yang saudada kumpulkan yaitu...",
      options: [
        "A. Dokumen Kualifikasi",
        "B. Kertas Kerja Evaluasi",
        "C. Dokumen Analisis Pasar",
        "D. Dokumen Tender"
      ],
      answer: "C"
    },
    {
      question: "Pokja Pemilihan Kota XYZ akan melakukan Pengadaan Jasa Analisa Dampak Lingkungan suatu kawasan yang akan dibangun Rumah Sakit. Metode Evaluasi Penawaran yang tepat digunakan yaitu...",
      options: [
        "A. Kualitas dan Biaya",
        "B. Biaya Selama Umur Ekonomis",
        "C. Sistem Nilai",
        "D. Harga Terendah"
      ],
      answer: "A"
    },
    {
      question: "Pokja Pemilihan/Pejabat Pengadaan setelah melakukan reviu Dokumen Persiapan Pengadaan, tahap selanjutnya menyusun dokumen pemilihan Barang/ajsa yang memuat informasi dan ketentuan yang harus ditaati oleh pihak dalam pemilihan Penyedia. Pernyataan berikut ini yang BUKAN tujuan penyusunan dokumen pemilihan yaitu...",
      options: [
        "A. Memberikan informasi yang lengkap tentang tata cara pelaksanaan proses pemilihan penyedia barang/jasa",
        "B. Memberikan informasi yang lengkap tentang ketentuan-ketentuan pelaksanaan pekerjaan;",
        "C. Memberikan informasi mengenai rincian harga perkiraan sendiri (HPS)",
        "D. Menyedian acuan bagi perserta pemilihan penyedia barang/jasa untuk menyusun penawaran"
      ],
      answer: "C"
    },
    {
      question: "Satuan kerja di Kementerian XYZ akan mengadakan jasa penasehat hukum/advokasi yang tidak direncanakan sebelumnya untuk menghadapi gugatan pihak tertentu, yang sifat pelaksanaan dan/atau pembelaannya harus segera dan tidak dapat ditunda. Metode pengadaan yang tepat untuk kasus tersebut yaitu...",
      options: [
        "A. Pengadaan langsung",
        "B. Tender",
        "C. E-Purchasing",
        "D. Penunjukan langsung"
      ],
      answer: "D"
    },
    {
      question: "Berikut ini yang perlu diperhatikan dalam melakukan reviu spesifikasi teknis/KAK yaitu ketentuan mengenai...",
      options: [
        "A. Denda Keterlambatan",
        "B. Penyesuaian Harga",
        "C. Pemberian Uang Muka",
        "D. Tingkat Komponen Dalam Negeri (TKDN)"
      ],
      answer: "D"
    },
    {
      question: "Risiko pada tahapan Penyusunan Dokumen Pemilihan Pekerjaan Pembangunan Pagar dengan nilai Rp 150 Juta yaitu...",
      options: [
        "A. Dokumen pengadaan langsung tidak sesuai dengan ketentuan atau karakteristik pekerjaan",
        "B. Menelaah kesesuaian dokumen pengadaan langsung",
        "C. Hasil perencanaan pengadaan langsung tidak sesuai dengan kebutuhan",
        "D. Potensi terjadi kesalahan dalam penentuan uang muka"
      ],
      answer: "A"
    },
    {
      question: "Para Pihak yang terlibat dalam negosiasi Pengadaan Barang pada tender dengan jumlah peserta yang memasukan penawaran dan lulus evaluasi teknsi hanya 1(satu) perserta yaitu...",
      options: [
        "A. Pejabat Pembuat Komitmen dan Penyedia",
        "B. Pengguna Anggaran dan Penyedia",
        "C. Pejabat Pnegadaan dan Peserta Pemilihan",
        "D. Pokja Pemilihan dan Calon Pemenang"
      ],
      answer: "D"
    },
    {
      question: "Skenario: Pejabat Pengadaan pada pengadaan buku dengan nilai Rp 90 Juta akan melakukan negosiasi dengan calon pemenang. <br> Instruksi: Sumber Data dan informasi yang harus Saudara kumpulkan sebagain Pejabat Pengadaan untuk melakukan negosiasi diantaranya yaitu...",
      options: [
        "A. Model Dokumen Pemilihan",
        "B. Dokumen Penawaran",
        "C. Dokumen Rencana Umum Pengadaan",
        "D. Dokumen Rencana Strategis"
      ],
      answer: "B"
    },
    {
      question: "Reviu dokumen persiapan Pengadaan Barang/Jasa dapat di definisikan sebagai aktivitas menelaah persiapan Pengadaan Barang/Jasa yang dilakukan oleh Pokja Pemilihan atau Pejabat Pengadaan. Tujuan reviu dokumen persiapan Pnegadaan Barang/Jasa yaitu...",
      options: [
        "A. Memastikan dokumen persiapan Pengadaan Barang/Jasa sesuai dengan ketentuan dan prinsip-prinsip pengadaan barang/jasa",
        "B. Meningkatkan pemahaman penyedia terhadap dokumen pengadaan barang/jasa",
        "C. Meningkatkan penggunaan produk impor daripada penggunaan produk dalam negeri",
        "D. Mneghindari terjadinya pengadaan barang/jasa yang tidak sesuai dengan kebutuhan"
      ],
      answer: "A"
    },
    {
      question: "Kepala Bagian Rumah Tangga Satuan Kerja Pemerintah Kabupaten ABC akan mengadakan konsumsi rapat untuk kegiatan lokakarya dengan pagu anggaran senilai Rp 60 Juta. Pihak yang terlibat dalam negosiasi teknis dan harga pada pengadaan tersebut yaitu...",
      options: [
        "A. Pejabat Pembuat Komitmen dengan Calon Penyedia Barang/Jasa",
        "B. Pokja Pmeilihan dengan Calon Pneyedia Barang/Jasa",
        "C. Pejabat Pengadaan dengan Calon Penyedia Barang/Jasa",
        "D. Kuasa Pengguna Anggaran dengan Calon Penyedia Barang/Jasa"
      ],
      answer: "C"
    },
    {
      question: "Berikut ini yang BUKAN merupakan Pengadaan Barang/Jasa yang dilaksanakan berdasarkan tafir barang/jasa ditetapkan pemerintah dan dipublikasikan secara luas kepada masyarakat yaitu...",
      options: [
        "A. Hotel",
        "B. Bahan Bakar Minyak",
        "C. Air dari PDAM",
        "D. Listrik"
      ],
      answer: "A"
    },
    {
      question: "Salah satu risiko dalam reviu dokumen persiapan pada pekerjaan jasa konsultasi pengawasan jalan dan jembatan dengan HPS senilai Rp 210 Juta yaitu hasil reviu terhadap dokumen persiapan tersebut tidak sesuai dengan ketentuan. Penanganan yang dapat dilakukan terhadat risiko tersebut yaitu...",
      options: [
        "A. Pembinaan bagi Para Konsultan Konstruksi",
        "B. Peningkatan kompetensi PPK",
        "C. Melibatkan tenaga ahli dalam mengevaluasi penawaran",
        "D. Melengkapi data dan informasi untuk proses negosiasi"
      ],
      answer: "B"
    },
    {
      question: "Metode pemilihan pada perkerjaan pembangunan dinding penahan tanah yang harus segera dilaksanakan dalam penanganan keadaan darurat akibat bencana tanah longsor di Provinsi XYZ dengan nilai Rp 500 Juta yaitu...",
      options: [
        "A. Melakukan pemilihan langsung",
        "B. Melakukan PBJ Darurat, dengan Pejabat Pengadaan atau Pokja Pmeilihan mencari penyedia",
        "C. Melakukan PBJ Darurat, dengan PPK mencari penyedia",
        "D. Melakukan Tender, dengan Pokja mencari penyedia"
      ],
      answer: "C"
    },
    {
      question: "Pemerintah Kabupaten XYZ akan mengadakan alat kesehatan di RSUD Kabupaten XYZ dengan nilai Rp 350 Juta, alat kesehatan tersebut tercantum damal e-katalog. Metode pemilihan yang cocok digunakan yaitu...",
      options: [
        "A. Pengadaan Langsung",
        "B. E-Purchasing",
        "C. Penunjukan Langsung",
        "D. Tender Cepat"
      ],
      answer: "B"
    }
  ],

  // Modul 5
  'modul5': [
    {
      question: "Sebelum serah terima pekerjaan rehabilitasi gedung kantor dari penyedia kepada PPK, PPK melakukan pemeriksaan terhadap hasil perkerjaan, yang dapat dibantu oleh...",
      options: [
        "A. Konsultan Pengawas atau Tim Ahli dan Tim Teknis",
        "B. Pengguna Barang/Jasa",
        "C. Panitia Pemeriksa Hasil Pekerjaan",
        "D. Pejabat Pemeriksa Hasil Pengadaan"
      ],
      answer: "A"
    },
    {
      question: "Risiko yang dapat terjadi pada tahapan pengendalian kontrak pengadaan yaitu...",
      options: [
        "A. Terjadinya keterlambatan penyerahan jaminan pelaksanaan",
        "B. Tidak adanya pemberian sanksi akibat pemutusan kontrak",
        "C. Pelaksanaan addendum kontrak tidak sesuai dengan ketentuan",
        "D. Kesalahan penentuan masa berlaku jaminan pelaksanaan"
      ],
      answer: "C"
    },
    {
      question: "PPK pada satuan kerja pemerintah daerah Provinsi ABC akan melakukan evaluasi kinerja penyedia pengadaan peralatan survei dengan nilai Rp 365 Juta. Bahan/sumber data/informasi yang dibutuhkan dalam tahap evaluasi kinerja penyedia yaitu...",
      options: [
        "A. Daftar kuantitas dan harga",
        "B. Berita acara hasil pemilihan penyedia",
        "C. Dokumen kontrak",
        "D. Dokumen rencana umum pengadaan"
      ],
      answer: "C"
    },
    {
      question: "Pejabat yang memiliki kewenangan untuk menandatangani kontrak yaitu...",
      options: [
        "A. Pejabat Pembuat Komitmen",
        "B. Pejaabt Pemeriksa Barang",
        "C. Pejabat Pengadaan",
        "D. Pejabat Pelaksana Teknis Kegiatan"
      ],
      answer: "A"
    },
    {
      question: "Dinas Pekerjaan Umum akan melaksanakan seleksi Jasa Konsultan Konstruksi perencanaan pembangunan gedung kantor dengan nilai Rp 198 Juta. Data/Informasi yang dibutuhkan oleh PPK dalam tahapan perumusan kontrak yaitu...",
      options: [
        "A. Lokasi Serah Terima Barang",
        "B. KAK/Spesifikasi Teknis",
        "C. Tahapan pembayaran uang muka",
        "D. Laporan Akhir"
      ],
      answer: "B"
    },
    {
      question: "Melakukan pengecekan klausul pada rancanngan kontrak dengan peraturan/pedoman yang berlaku untuk menghindari kesalahan dalam merumuskan isi kontrak merupakan penannganan risiko pada tahapan...",
      options: [
        "A. Pengendalian Kontrak",
        "B. Serah Terima Hasil Pekerjaan",
        "C. Persiapan Pengadaan",
        "D. Persiapan Kontrak"
      ],
      answer: "C"
    },
    {
      question: "Dalam hal terjadi deviasi antara realisasi dengan target pelaksanaan kontrak atau terjadi kritis pada pembangunan gedung kantor, maka para pihak melakukan...",
      options: [
        "A. Rapat Penanganan Darurat",
        "B. Rapat Pembuktian (Show Cause Meeting)",
        "C. Rapat Persiapan Pelaksanaan Kontrak (Pre Construction Meeting)",
        "D. Rapat Pembuktian Kualifikasi"
      ],
      answer: "B"
    },
    {
      question: "Rapat yang dapat terjadi pada tahapan perumusan rangcangan kontrak pengadaan benih ikan senilai Rp 250 Juta adalah...",
      options: [
        "A. Terjadinya keterlambatan serah terima pekerjaan",
        "B. Kesalahan dalam merumuskan isi kontrak",
        "C. Penilaian PPK terhadap kinerja penyedia tidak objektif",
        "D. Dokumen yang dilampirkan sebagai lampiran kontrak tidak sesuai"
      ],
      answer: "B"
    },
    {
      question: "Pengendalian kontrak merupakan tahapan pelaksanaan pengadaan barang/jasa yang dilakukan setelah kontrak ditandatangani oleh kedua belah pihak. Hal apa saja yang perlu dikendalikan dalam pengendalian kontrak?",
      options: [
        "A. Waktu, kualitas dan kuantitas, fungsi dan lokasi penyerahan akhir barang/jasa",
        "B. Tenaga kerja, waktu, kualitas dan kuantitas barang/jasa",
        "C. Tenaga kerja, waktu, kualitas dan fungsi barang/jasa",
        "D. Waktu, kualitas dan kuantitas, dan keuangan barang/jasa"
      ],
      answer: "A"
    },
    {
      question: "Pusat pengembangan sumber daya manusia AB telah melaksanakan pemilihan penyedia jasa pengamanan guna mendukung kegiatan pembelajaran dan suasana kerja yang kondusif dan aman dengan nilai kontrak Rp 267 Juta. Data/informasi yang dibutuhkan oleh PPK sebelum penandatanganan kontrak yaitu...",
      options: [
        "A. Identitas calon penyedia dan nilai pekerjaan",
        "B. Rencana Anggaran Biaya (RAB)",
        "C. Kerangka Acuan Kerja (KAK)",
        "D. Spesifikasi Teknis dan metode pengamanan"
      ],
      answer: "A"
    },
    {
      question: "Penilaian kinerja penyedia oleh PPK dilakukan...",
      options: [
        "A. Setelah Berita Acara Serah Terima Akhir (BAST-A) ditandatangani",
        "B. Setelah Rapat Persiapan Pelaksanaan Kontrak",
        "C. Setelah Rapat Pembuktian (Show Cause Meeting/SCM)",
        "D. Setelah Reviu Dokumen Persiapan Pengadaan dengan Pokja Pemilihan"
      ],
      answer: "A"
    },
    {
      question: "Setelah Penandatanganan Berita Acara Serah Terima (BAST) konsultan perencanaan, aktivitas selanjutnya yang dilakukan oleh PPK yaitu...",
      options: [
        "A. Menilai kinerja penyedia",
        "B. Melakukan evaluasi kualifikasi",
        "C. Melakukan evaluasi penawaran",
        "D. Melakukan evaluasi teknis"
      ],
      answer: "A"
    },
    {
      question: "Tim yang membantu Pejabat Penandatanganan Kontrak dibentuk dari unsur Kementrian/Lembaga/Pemerintah Daerah untuk menyusun perencanaan pengadaan, menetapkan spesifikasi teknis/KAK, menetapkan rancangan kontrak, menetapkan HPS, dan melakukan pengawasan/pengendalian pelaksanaan kontrak yaitu...",
      options: [
        "A. Tim Pengawas",
        "B. Tim Teknis",
        "C. Tim Ahli",
        "D. Tim Pendukung"
      ],
      answer: "B"
    },
    {
      question: "Bentuk kontrak berupa surat perjanjian yang paling tepat digunakan untuk paket pengadaan...",
      options: [
        "A. Rehabilitasi Gedung kantor dengan nilai kontrak Rp 179 Juta",
        "B. Pengadaan Laptop dengan metode e-purchasing dengan nilai Rp 210 Juta",
        "C. Alat Tulis Kantor (ATK) dengan nilai kontrak Rp 15 Juta",
        "D. Pengawasan Gedung dengan nilai kontrak Rp 120 Juta"
      ],
      answer: "D"
    },
    {
      question: "Berdasarkan hukum perdata diatur dalam pasal 1313 kitab undang-undang hukum perdata (KUHPerdata), suatu perbuatan di mana satu orang atau lebih mengikatkan dirinya terhadap satu orang lain atau lebih disebut?",
      options: [
        "A. Perjanjian",
        "B. Kesepakatan",
        "C. Permufakatan",
        "D. Persetujuan"
      ],
      answer: "A"
    }
  ],

  // Modul 6
  'modul6': [
    {
      question: "Berikut ini yang BUKAN merupakan metode pembayaran untuk pekerjaan swakelola kegiatan pengelolaan pembudidayaan ikan pada dinas kelautan dan perikanan provinsi B berdasarkan persentase prestasi kemajuan pekerjaan yaitu...",
      options: [
        "A. Bulanan",
        "B. Sesuai Kemampuan Bendara",
        "C. Sekaligus",
        "D. Termin"
      ],
      answer: "B"
    },
    {
      question: "Skenario: Tim Pengawas kegiatan swakelola penyediaan data dan informasi usaha pertanian pada dinas pertanian provinsi B melakukan verifikasi administrasi dan dokumentasi serta pelaporan, pengawasan teknis yaitu pengawasan terhadap kemajuan pelaksanaan kegiatan, pengawasan penggunaan tenaga kerja, peralatan dan bahan, serta pengawasan tertib administrasi keuangan.<br> Instruksi: Dari kasus diatas, yang diperlukan untuk mengetahui realisasi fisik pekerjaan secara berkala yang disampaikan tim pengawas yaitu...",
      options: [
        "A. Metode/tahapan pelaksanaan swakelola",
        "B. Data kontrak swakelola pada kegiatan sejenis pada tahun sebelumnya",
        "C. Para pihak yang akan melakasanakan swakelola",
        "D. Laporan kemajuan pelaksanaan pekerjaan, penggunaan tenaga kerja, peralatan dan bahan"
      ],
      answer: "D"
    },
    {
      question: "Pemeriksaan terhadap hasil pekerjaan swakelola dilakukan oleh...",
      options: [
        "A. Tim Perencana Swakelola",
        "B. Tim Pengawas Swakelola",
        "C. Tim Persiapan Swakelola",
        "D. Tim Pelaksana Swakelola"
      ],
      answer: "B"
    },
    {
      question: "Dinas kesehatan kabupaten XYZ melaksanakan swakelola pembuatan jamban keluarga dengan kelompok masyarakat desa kemuning dan akan dihibahkan kepada masyarakat. Jika cara pembayaran menggunakan termin, maka pelaksanaan pembayaran pekerjaannya...",
      options: [
        "A. Sesuai dengan tahapan pembayaran yang telah disepakati dalam kontrak swakelola",
        "B. Setelah hasil pekerjaan diserahkan kepada masyarakat melalui hibah",
        "C. Dilakukan 2 kali yaitu serah terima pertama dan serah terima akhir",
        "D. Setelah pekerjaan selesai 100% sesuai kontrak swakelola"
      ],
      answer: "A"
    },
    {
      question: "Tenaga ahli yang dapat digunakan pada swakelola tipe II yaitu...",
      options: [
        "A. Paling banyak 10% (sepuluh persen) dari jumlah Tim Pelaksana",
        "B. Berjumlah 1 (satu) orang",
        "C. Sekurang-kurangnya 10% (sepuluh persen) dari jumlah Tim Pelaksana",
        "D. Tidak boleh melebihi 50 (lima puluh persen) dari jumlah anggota Penyelenggara Swakelola"
      ],
      answer: "A"
    },
    {
      question: "Salah satu ketentuan pembayaran dalam swakelola yaitu...",
      options: [
        "A. Memperhitungkan PPN",
        "B. Tidak memperhitungkan PPN",
        "C. Pembayaran hanya dapat dilakukan secara sekaligus",
        "D. Memperhitungkan keuntungan penyelenggara swakelola"
      ],
      answer: "A"
    },
    {
      question: "Skenario: Dinas kelautan dan perikana provisin B akan melaksanakan pekerjaan pengelolaan kawasan konservasi di wilayah pesisir pulau-pulau kecil secara swakelola. <br> Instruksi: Untuk memastikan pekerjaan dapat berjalan sesuai rencana kegiatan, maka yang dapat dijadikan sumber informasi pada saat persiapan swakelola yaitu...",
      options: [
        "A. Dokumen Satuan Harga",
        "B. Daftar pegawai pada instansi",
        "C. Database kontrak",
        "D. Data identifikasi kebutuhan"
      ],
      answer: "B"
    },
    {
      question: "Kegiatan yang dilaksanakan pada tahap persiapan swakelola adalah...",
      options: [
        "A. Penyusunan RAB",
        "B. Penetapan Tipe Swakelola",
        "C. Penyusunan Spesifikasi Teknis/KAK",
        "D. Reviu RAB"
      ],
      answer: "D"
    },
    {
      question: "Jika sekelompok masyarakat sebagai pelaksana swakelola mampu melaksanakan pengadaan bahan/alat/material untuk mendukung swakelola, maka pengadaan bahan/alat/material dilakukan oleh...",
      options: [
        "A. Tim Persiapan",
        "B. Tim Pelaksana",
        "C. Tim Pengawas",
        "D. Tim Teknis"
      ],
      answer: "B"
    },
    {
      question: "Pihak yang bertugas untuk mencatat, mengevaluasi, mendokumentasikan kegiatan dan melaporkan secara berkala kemajuan kegiatan dan penyerapan anggaran pada pekerjaan swakelola Penyediaan Data Series Kawasan Konservasi Laut Daerah (KKLD) pada dinas kelautan perikanan provinsi B yang dilaksanakan oleh perguruan tinggi negeri provinsi B yaitu...",
      options: [
        "A. Tim pengawas swakelola dari dinas kelauran dan perikanan provinsi B",
        "B. Tim pelaksana swakelola dari dinas kelauran dan perikanan provinsi B",
        "C. Tim pengawas swakelola dari perguruan tinggi negeri provinsi B",
        "D. Tim pelaksana swakelola dari perguruan tinggi negeri provinsi B"
      ],
      answer: "D"
    },
    {
      question: "Kegiatan yang BUKAN tahapan persiapan pada perkarjaan swakelola pengawasan usaha perikanan yang diberikan sendiri oleh dinas kelautan dan perikanan provinsi B yaitu...",
      options: [
        "A. Menetapkan penyelenggara swakelola",
        "B. Menetapkan rencana kegiatan",
        "C. Penandatanganan berita acara pemeriksaan hasil pekerjaan",
        "D. Reviu spesifikasi teknis/KAK dan RAB"
      ],
      answer: "C"
    },
    {
      question: "Salah satu perbedaan ketentuan dalam pelaksanaan swakelola tipe I dan swakelola tipe IV yaitu mengenai...",
      options: [
        "A. Pihak yang menerima laporan",
        "B. Sanksi pada pelaksana swakelola",
        "C. Serah terima pekerjana",
        "D. Cara pembayaran"
      ],
      answer: "B"
    },
    {
      question: "Salah satu tugas Tim Persiapan pada swakelola pelatihan teknologi tepat guna yang dilaksanakan oleh kelompok masyarakat desa XYZ yaitu melakukan reviu...",
      options: [
        "A. Rancangan kontrak",
        "B. Spesifikasi teknis dan RAB",
        "C. Dokumen penetapan tipe swakelola",
        "D. Rencana dan jadwal kegiatan"
      ],
      answer: "B"
    },
    {
      question: "Jika PPK mengetahui bahwa kelompok masyarakat desa XYZ sebagai pelaksana swakelola tidak mampu melaksanakan proses pengadaan bahan/material dan alat untuk mendukung swakelola. Tindakan yang harus dilakukann oleh PPK...",
      options: [
        "A. Membatalkan sebagai pelaksana swakelola",
        "B. Mengenakan sanksi kepada kelompok masyarakat pelaksana swakelola",
        "C. Membatalkan kegiatan swakelola dan mengubah cara pengadaan melalui penyedia",
        "D. Membuat kontrak terpisah bahan/material dan alat dengan penyedia"
      ],
      answer: "D"
    },
    {
      question: "Salah satu alternatif yang dapat diambil agar pelaksanaan swakelola berjalan sesuai rencana dan jadwal yaitu...",
      options: [
        "A. Melakukan revisi penetapan rencana dan jadwal pelaksanaan",
        "B. Melakukan monitoring secara berkala",
        "C. Melakukan monitoring jika pekerjaan terlambat",
        "D. Pekerjaan dijaminkan kepada pihak asuransi"
      ],
      answer: "B"
    }
  ],

  // Modul 7
  'modul7': [
    {
      question: "Rantai suplai panjang dalam manajemen rantai pasok adalah kegiatan yang dimulai dari pengadaan dari penyedia (supplier), dilanjutkan dengan produksi (diinternal organisasi) sampai dengan...",
      options: [
        "A. Evaluasi penawaran dan penandatanganan kontrak",
        "B. Pengendalian publik",
        "C. Pengiriman dan serah terima di masyarakat (customer)",
        "D. Penyusunan HPS dan penyusunan spesifikasi teknis"
      ],
      answer: "C"
    },
   {
      question: "Kegiatan yang bukan termasuk aktivitas pengadaan barang/jasa pemerintag dalam siklus manajemen rantai pasok MAKE yaitu...",
      options: [
        "A. Melakukan proses produksi",
        "B. Administrasi pergudangan",
        "C. Menetapkan rencana kinerja tahunan",
        "D. Pengendalian kualitas mutu"
      ],
      answer: "C"
    },
    {
      question: "Contoh kegiatan yang BUKAN merupakan bagian dari rantai pasok produk laptop yaitu...",
      options: [
        "A. Perakitan laptop di pabrik",
        "B. Pengantaran laptop oleh distributor",
        "C. Instalasi software setelah pembelian oleh pelanggan",
        "D. Pengadaan komponen hardware oleh supplier"
      ],
      answer: "C"
    },
    {
      question: "Berikut ini yang BUKAN termasuk siklus manajemen rantai paso yaitu...",
      options: [
        "A. Make",
        "B. Return",
        "C. Plan",
        "D. Source"
      ],
      answer: "B"
    },
    {
      question: "Dinas kesehatan provisni X menyusun rencana strategis tentang penanganan pencegahan stunting pada anak. Kegiatan ini termasuk penerapan manajemen rantai pasok pada tingkatan manajerial level...",
      options: [
        "A. Pimpinan",
        "B. Operasional",
        "C. Taktis",
        "D. Strategis"
      ],
      answer: "D"
    },
    {
      question: "Berikut ini yang merupakan penerapan manajemen rantai pasok pada siklus plan dalam aktivitas PBJP yaitu...",
      options: [
        "A. PPK memilih cara pengadaan barang/jasa berdasarkan hasil identifikasi kebutuhan",
        "B. PPK melakukan pengendalian kontrak",
        "C. PPK dan Penyedia melakukan serah terima barang/jasa sesuai kontrak",
        "D. Pokja Pemilihan melakukan evaluasi penawaran sesuai dokumen pemilihan"
      ],
      answer: "A"
    },
    {
      question: "Data penyedia untuk pekerjaan konstruksi pada dinas pekerjaan umum provinsi X telah tersusun beserta hasil penilaian kinerja. Dana ini bermanfaat untuk proses pemilihan selanjutnya. Kegiatan ini termasuk penerapan manajemen rantai pasok pada tingkatan maanjerial level...",
      options: [
        "A. Operasional",
        "B. Taktis",
        "C. Strategis",
        "D. Pimpinan"
      ],
      answer: "B"
    },
    {
      question: "Pemerintah negara jepang memberikan pinjaman untuk membantu pemerintah indonesia mewujudkan konektivitas antar wilayah. Wujud pembangunan berupa jalan tol dengan pembangunan terowongan di beberapa titik. Kegiatan ini termasuk rantai supply...",
      options: [
        "A. Panjang",
        "B. Sederhana",
        "C. Kompleks",
        "D. Pendek"
      ],
      answer: "C"
    },
    {
      question: "Dinas komunikasi dan informasi kabupaten XYZ akan mengadakan perangkat elektronik berupa laptop untuk server LPSE. Kegiatan ini termasuk rantai pasok supply...",
      options: [
        "A. Tidak termasuk kategori rantai supply karena pekerjaan sederhana",
        "B. Pendek",
        "C. Panjang",
        "D. Kompleks"
      ],
      answer: "B"
    },
    {
      question: "Pokja Pemilihan melaksanakan proses pemilihan penyedia paket pekerjaan pembangunan jembatan sungai rupat senilai Rp 40 Miliar. Kegiatan ini termasuk penerapan manajemen rantai pasok pada tingakatan manajerial level...",
      options: [
        "A. Pimpinan",
        "B. Taktis",
        "C. Operasional",
        "D. Strategis"
      ],
      answer: "C"
    },
    {
      question: "Penyedia obat pada katalog elektronik pemerintah melaksanakan proses pengiriman dengan menggunakan modal transportasi darat yang membutuhkan waktu lama dan mengakibatkan beberapa produk kadaluarsa. Karena adanya komplain dari pembeli, pihak manajemen selanjutnya mengubah pola pengiriman dengan pengiriman melalui angkatan udara. Hal ini termasuk aspek manajemen...",
      options: [
        "A. Efficiency (Efisien)",
        "B. Responsiveness (Responsif)",
        "C. Agility (Fleksibel dan Adaftif)",
        "D. Reliability (Andal)"
      ],
      answer: "B"
    },
    {
      question: "Proses yang dilaksanakan sebelum siklus SOURCE pada manajemen/pengelolaan rantai pasok yaitu...",
      options: [
        "A. MAKE",
        "B. SOURCE",
        "C. DELIVER",
        "D. PLAN"
      ],
      answer: "D"
    },
    {
      question: "Perusahaan produksi laptop melaksanakan survei terhadap konsumen mereka, diperoleh data bahwa laptop yang diproduksi cepat panas dan lambat untuk aplikasi desain. Atas temuan tersebut, manajemen melaksanakan evaluasi dan melakukan perbaikan terhadap komponen laptop untuk meningkatkan kualitas produknya. Berdasarkan supply chain council scor, tindakan yang dilakukan termasuk pada aspek manajemen...",
      options: [
        "A. Agility (Fleksibel dan Adaptif)",
        "B. Efficiency (Efisien)",
        "C. Reliability (Andal)",
        "D. Asset Productivity (Produktivitas Aset)"
      ],
      answer: "C"
    },
    {
      question: "Pokja pemilihan UKPBJ kota ABC melakukan proses tender pekerjaan pembangunan gedung kantor dengan nilai HPS sebesar Rp 5 Miliar. Pelaksanaan proses tender tersebut merupakan implementasi pada siklus manajemen rantai pasok...",
      options: [
        "A. Make",
        "B. Source",
        "C. Plan",
        "D. Deliver"
      ],
      answer: "B"
    },
    {
      question: "Di Kabupaten KLM terjadi bencana alam gempa bumi mengakibatkan kerusakan infrastruktur yang cukup besar. Pemerintah kabupaten KLM selanjutnya melaksanakan perbaikan infrastruktur yang mengalami kerusakan. Kegiatan pengadaan barang/jasa yang dilakukan pemerintah kabupaten tersebut termasuk jenis kegiatan...",
      options: [
        "A. PBJP Rutin",
        "B. PBJP Tanggap Darurat",
        "C. PBJP Proyek",
        "D. PBJP Internasional"
      ],
      answer: "B"
    }
  ]

};

// Variabel global
let QUIZ_CONFIG = null; 
let questions;
let countdownInterval; // This is the line you need to add
let currentQuestionIndex = 0;
let userAnswers = [];
let isShowingResults = false;

// 3. URL PARAMETER HANDLING
function handleUrlParameters() {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const soal = urlParams.get('soal');
    const view = urlParams.get('view');
    
    if (id && QUIZ_CONFIGS[id]) {
        QUIZ_CONFIG = QUIZ_CONFIGS[id];
        questions = QUIZ_QUESTIONS[id] || [];
    } else {
        // Default to first available quiz if no ID specified
        const firstAvailableQuiz = Object.keys(QUIZ_CONFIGS).find(key => QUIZ_CONFIGS[key].READY);
        if (firstAvailableQuiz) {
            QUIZ_CONFIG = QUIZ_CONFIGS[firstAvailableQuiz];
            questions = QUIZ_QUESTIONS[firstAvailableQuiz] || [];
        }
    }

    // Hide all containers first
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.MAINPAGE).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.LANDING_PAGE_CONTAINER).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_CONTENT_CONTAINER).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.RESULT_CONTAINER).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.NOT_FOUND_CONTAINER).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.HELP_CONTAINER).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.SETTINGS_CONTAINER).style.display = 'none';
    
  if (view === 'notifications') {
    showNotificationsPage();
    return;
  }

    if (view === 'settings') {
        showSettingsPage();
        return;
    }

    if (view === 'help') {
        showHelpPage();
        return;
    }

    // If no parameters, show main page
    if (!id && !soal && !view) {
        showMainPage();
        return;
    }
    
    const quizId = id;
    if (!QUIZ_CONFIGS[quizId] || !QUIZ_QUESTIONS[quizId]) {
       showNotFoundPage();
       return;
    }

    // Check if time has expired but no results exist
    if (QUIZ_CONFIG && isTimeExpired() && !storage.get(QUIZ_CONFIG.KEYS.RESULTS)) {
        // Force finish the quiz
        finishQuiz('expired');
        return;
    }

    // Set current configuration and questions
       QUIZ_CONFIG = QUIZ_CONFIGS[quizId];
       questions = QUIZ_QUESTIONS[quizId];
    
    // Check if quiz is ready
    if (!QUIZ_CONFIG.READY) {
        showDisabledQuizMessage();
        return;
    }

    // Set page title
    document.title = QUIZ_CONFIG ? `${QUIZ_CONFIG.QUIZ_TITLE}` : "Pilih Quiz";
    
    // Validate quiz ID
    if (!QUIZ_CONFIGS[quizId] || !QUIZ_QUESTIONS[quizId]) {
        showNotFoundPage();
        return;
    }
    
    // Moved loadProgress() to after QUIZ_CONFIG is set
    loadProgress();

    if (!soal && !view) {
        showLandingPage();
        return;
    }
    
    // Handle different view parameters
    if (view === 'results') {
        showResults();
    } else if (view === 'help') {
        showHelpPage();
    } else if (soal) {
        const questionNumber = parseInt(soal);
        if (!isNaN(questionNumber) && questionNumber >= 1 && questionNumber <= questions.length) {
            startQuiz(questionNumber - 1);
        } else {
            showNotFoundPage();
        }
    } else {
        showLandingPage();
    }
}

function showMainPage() {
    const mainPage = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.MAINPAGE);
    const quizList = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_LIST);
    
    quizList.innerHTML = '';

    // Add all quizzes (both available and unavailable)
    for (const [id, config] of Object.entries(QUIZ_CONFIGS)) {
        const quizItem = document.createElement('div');
        quizItem.className = `quiz-item ${config.READY ? '' : 'disabled-quiz'}`;
        
        // Check if there are saved results for this quiz
        let recentScoreHTML = '';
        let timeInfoHTML = '';
        if (config.READY) {
            const results = localStorage.getItem(`${config.STORAGE_KEY}_${config.KEYS.RESULTS}`);
            
            if (results) {
                try {
                    const resultData = JSON.parse(results);
                    const percentage = resultData.percentage || 0;
                    const isPassed = percentage >= config.PASSING_SCORE;
                    const duration = resultData.duration ? formatDuration(resultData.duration) : '';
                    
                    recentScoreHTML = `
                        <div class="quiz-result-infos">
                            <div class="d-flex align-items-center gap-2 mb-1">
                                <span class="text-muted small">Skor Terakhir:</span>
                                <span class="badge ${isPassed ? 'bg-success' : 'bg-danger'}">
                                    ${resultData.score || 0} / ${calculateMaxPossibleScoreForConfig(config)}
                                </span>
                                <span class="badge d-none ${isPassed ? 'bg-success' : 'bg-danger'}">
                                    ${percentage}%
                                </span>
                                <span class="badge ${isPassed ? 'bg-success' : 'bg-danger'}">
                                    ${isPassed ? 'Lulus' : 'Tidak Lulus'}
                                </span>
                            </div>
                            ${duration ? `
                            <div class="d-flex align-items-center gap-2 small text-muted">
                                <i class="bi bi-clock-history"></i>
                                <span>${duration}</span>
                            </div>
                            ` : ''}
                        </div>
                    `;
                } catch (e) {
                    console.error('Error parsing results:', e);
                }
            }
        }
        
        quizItem.innerHTML = `
            <div class="quiz-content">
                <div class="quiz-header">
                    <h5 class="quiz-title">${config.QUIZ_TITLE}</h5>
                    ${!config.READY ? '<div class="quiz-unavailable-badge">Tidak tersedia</div>' : ''}
                </div>
                ${recentScoreHTML}
                <div class="quiz-meta">
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge quiz-question-count">
                            <i class="bi bi-journal-text"></i> ${config.QUESTION_COUNT} Soal
                        </span>
                        <span class="badge quiz-duration">
                            <i class="bi bi-clock"></i> ${Math.floor(config.DURATION / (60 * 1000))} Menit
                        </span> 
                    </div>
                    ${config.READY ? 
                        '<i class="bi bi-chevron-right quiz-arrow"></i>' : 
                        '<i class="bi bi-lock-fill quiz-lock"></i>'
                    }
                </div>
            </div>
        `;
        
        if (config.READY) {
            const quizLink = document.createElement('a');
            quizLink.href = `/pelatihan/modul/?id=${id}`;
            quizLink.className = 'quiz-link';
            quizLink.innerHTML = quizItem.innerHTML;
            quizList.appendChild(quizLink);
        } else {
            quizList.appendChild(quizItem);
        }
    }
    
    // Show the main page
    mainPage.style.display = 'block';
}

function showSettingsPage() {
    const settingsContainer = document.getElementById('settingsContainer');
    settingsContainer.style.display = 'block';
    
    // Add event listener for clear data button
    document.getElementById('clearAllDataBtn').addEventListener('click', function() {
        showUniversalModal('clear-data');
    });
}

function showNotFoundPage() {
    // Safely get all container elements
    const containers = {
        notFound: document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.NOT_FOUND_CONTAINER),
        landing: document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.LANDING_PAGE_CONTAINER),
        quiz: document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_CONTENT_CONTAINER),
        result: document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.RESULT_CONTAINER),
        help: document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.HELP_CONTAINER),
        main: document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.MAINPAGE)
    };

    // Hide all containers that exist
    Object.values(containers).forEach(container => {
        if (container) {
            container.style.display = 'none';
        }
    });

    // Show the not found container if it exists
    if (containers.notFound) {
        containers.notFound.style.display = 'block';
    } else {
        console.error('Not found container element missing!');
    }
}

function showDisabledQuizMessage() {
    // Hide other containers
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.MAINPAGE).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_CONTENT_CONTAINER).style.display = 'none';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.RESULT_CONTAINER).style.display = 'none';
    
    // Show message in not found container
    const notFoundContainer = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.NOT_FOUND_CONTAINER);
    notFoundContainer.innerHTML = `
        <div class="card shadow">
            <div class="card-body">
                <h2>Kuis Tidak Tersedia</h2>
                <p class="lead">Kuis ini belum tersedia. Silakan pilih kuis lain yang tersedia.</p>
                <a href="/pelatihan/modul/" class="btn btn-primary mt-3">
                    <i class="bi bi-house-door"></i> Kembali ke Beranda
                </a>
            </div>
        </div>
    `;
    notFoundContainer.style.display = 'block';
}

function showLandingPage() {
    const landingPageContainer = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.LANDING_PAGE_CONTAINER);
    landingPageContainer.innerHTML = createLandingPage();
    landingPageContainer.style.display = 'block';
    
    // Add event listeners using event delegation
    landingPageContainer.addEventListener('click', function(e) {
        // Handle main action button
        if (e.target.closest('#mainActionBtn')) {
            const result = storage.get(QUIZ_CONFIG.KEYS.RESULTS);
            const hasPreviousResults = result && result.score !== undefined;
            
            if (hasPreviousResults) {
                // Show results view
                const params = new URLSearchParams(window.location.search);
                params.set('view', 'results');
                window.location.search = params.toString();
            } else {
                // Start new quiz
                startQuiz(0);
            }
        }
        
        // Handle reset button
        if (e.target.closest('#resetQuizBtn')) {
            e.preventDefault();
            showUniversalModal('reset');
        }
    });
}

function showHelpPage() {
    const helpContainer = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.HELP_CONTAINER);
    const accordion = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.HELP_ACCORDION);
    
    // Sample FAQ data - you can customize this
    const faqItems = [
        {
            question: "Bagaimana cara memulai ujian?",
            answer: "Dihalaman <a href='/pelatihan/modul/'>utama/beranda</a>, pilih ujian yang ingin dikerjakan dan akan dialihkan kehalaman ujian, Klik tombol 'Mulai Sekarang' untuk memulai ujian."
        },
        {
            question: "Berapa lama waktu yang diberikan untuk mengerjakan ujian?",
            answer: "Anda diberikan waktu 120 menit (atau 2 jam) untuk menyelesaikan seluruh soal."
        },
        {
            question: "Bagaimana cara membagikan hasil ujian?",
            answer: "Hanya Anda yang dapat melihat/mengakses hasil ujian dan tidak dapat membagikan link/url hasil kepada siapapun karena hasil tersebut tersimpan di Local Storage/Penyimpanan Lokal Browser Anda. Namun Anda dapat membagikan hasil dengan mengunduhnya sebagai file PDF dengan menekan tombol <span class='bi bi-download btn btn-sm btn-secondary'> Cetak Hasil</span>"
        },
        {
            question: "Apakah saya diwajibkan untuk mengisi data peserta?",
            answer: "Tidak. Anda tidak diwajibkan untuk mengisi data peserta."
        },
        {
            question: "Apakah ujian ini berbayar?",
            answer: "Tidak. Ujian ini gratis tidak dipungut biaya apapun."
        },
        {
            question: "Bagaimana Saya menghapus semua data hasil dan data lainnya?",
            answer: "Pergi ke halaman <a href='?view=settings'>pengaturan/setting</a>, dibagian Hapus Data, klik tombol <b>Hapus Semua Data</b>."
        },
        {
            question: "Bagaimana cara Saya mengetahui ujian yang sedang/masih berjalan?",
            answer: "Anda dapat melihat ujian yang sedang berjalan di halaman <a href='?view=notifications'>notifikasi</a>."
        }
    ];

    // Generate FAQ items
    accordion.innerHTML = faqItems.map((item, index) => `
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed shadow-none" type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#helpCollapse${index}">
                    ${item.question}
                </button>
            </h2>
            <div id="helpCollapse${index}" class="accordion-collapse collapse" 
                 data-bs-parent="#helpAccordion">
                <div class="accordion-body bg-light">
                    ${item.answer}
                </div>
            </div>
        </div>
    `).join('');
    
    helpContainer.style.display = 'block';
    document.title = "Bantuan";
    
    // Initialize Bootstrap accordion functionality
    const accordionButtons = document.querySelectorAll('.accordion-button');
    accordionButtons.forEach(button => {
        button.addEventListener('click', function() {
            this.classList.toggle('collapsed');
        });
    });
}

// Fungsi storage
// Update the storage object to include error handling
const storage = {
    get: (key) => {
        try {
            const fullKey = `${QUIZ_CONFIG.STORAGE_KEY}_${key}`;
            const value = localStorage.getItem(fullKey);
            return value ? JSON.parse(value) : null;
        } catch (e) {
            console.error('Error reading from localStorage:', e);
            return null;
        }
    },
    set: (key, value) => {
        try {
            const fullKey = `${QUIZ_CONFIG.STORAGE_KEY}_${key}`;
            localStorage.setItem(fullKey, JSON.stringify(value));
        } catch (e) {
            console.error('Error writing to localStorage:', e);
        }
    },
    remove: (key) => {
        try {
            const fullKey = `${QUIZ_CONFIG.STORAGE_KEY}_${key}`;
            localStorage.removeItem(fullKey);
        } catch (e) {
            console.error('Error removing from localStorage:', e);
        }
    },
    clear: () => {
        try {
            Object.values(QUIZ_CONFIG.KEYS).forEach(key => {
                localStorage.removeItem(`${QUIZ_CONFIG.STORAGE_KEY}_${key}`);
            });
        } catch (e) {
            console.error('Error clearing localStorage:', e);
        }
    }
};

function startQuiz(initialQuestionIndex = 0) {
    // Clear any existing intervals
    clearInterval(countdownInterval);
    
    // Hide the landing page container
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.LANDING_PAGE_CONTAINER).style.display = 'none';
    
    // Initialize quiz container
    const quizContentContainer = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_CONTENT_CONTAINER);
    quizContentContainer.innerHTML = QuizContainer();
    quizContentContainer.style.display = 'block';
    
    // Load any existing progress
    loadProgress();
    
    // Set up quiz event listeners
    setupQuizEventListeners();
    
    // Start from the specified question
    currentQuestionIndex = initialQuestionIndex;
    initializeQuiz();
}

function showQuestion(index) {
    const { ELEMENT_IDS } = COMMON_QUIZ_CONFIG;
    const optionsForm = document.getElementById(ELEMENT_IDS.OPTIONS_FORM); 

    index = Math.max(0, Math.min(index, questions.length - 1));
    currentQuestionIndex = index;

    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.CURRENT_QUESTION_NUMBER).textContent = index + 1;
    optionsForm.innerHTML = '';
    
    const quizContainer = document.getElementById('quizContentContainer');
    quizContainer.style.display = 'block';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_CONTENT_CONTAINER).style.display = 'block';
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.RESULT_CONTAINER).style.display = 'none';

    if (storage.get(QUIZ_CONFIG.KEYS.RESULTS)) {
        showResults();
        return;
    }

    const questionNumber = index + 1;
    const range = QUIZ_CONFIG.SCORING_RULES.RANGES.find(r => 
        questionNumber >= r.from && questionNumber <= r.to
    );
    const points = range?.score || QUIZ_CONFIG.SCORING_RULES.DEFAULT_SCORE;
    document.getElementById(ELEMENT_IDS.QUESTION_POINTS).textContent = `(Nilai: ${points} Poin)`;

    storage.set(QUIZ_CONFIG.KEYS.CURRENT_QUESTION, currentQuestionIndex);
    updateURL();
    updateQuestionNumbers();
    updateProgressBar();
    
    document.getElementById(ELEMENT_IDS.PREV_BTN).disabled = index === 0;
    const isLastQuestion = index === questions.length - 1;
    document.getElementById(ELEMENT_IDS.FINISH_BTN).classList.toggle('d-none', !isLastQuestion);
    document.getElementById(ELEMENT_IDS.NEXT_BTN).classList.toggle('d-none', isLastQuestion);
    
    const currentQuestion = questions[index];
    const answerData = userAnswers[index];
    const questionTextElement = document.getElementById(ELEMENT_IDS.QUESTION_TEXT);
    
    questionTextElement.innerHTML = currentQuestion.question;
    
    if (currentQuestion.image) {
        const imgContainer = document.createElement('div');
        imgContainer.className = 'question-image-container mt-3 mb-4 text-center';
        const img = document.createElement('img');
        img.src = `/assets/images/pelatihan/${currentQuestion.image}`;
        img.alt = 'Gambar soal';
        img.className = 'img-fluid rounded border';
        img.style.maxHeight = '300px';
        imgContainer.appendChild(img);
        questionTextElement.appendChild(imgContainer);
    }

    const selectedValue = answerData?.userAnswer;
    const isSkipped = answerData?.isSkipped;
    const isAnswered = answerData && answerData.userAnswer !== undefined && answerData.userAnswer !== null;
    
    if (!currentQuestion.options || !Array.isArray(currentQuestion.options)) {
        console.error('Invalid options for question:', currentQuestion);
        optionsForm.innerHTML = '<div class="alert alert-danger">Error: Question options not loaded properly</div>';
        return;
    }

    currentQuestion.options.forEach((option, optionIndex) => {
        if (typeof option !== 'string') {
            console.error('Invalid option format at index', optionIndex, 'in question', index);
            return;
        }
        
        const value = option.substring(0, 1).toUpperCase();
        const isSelected = value === selectedValue;
        const isCorrectAnswer = value === currentQuestion.answer;
        
        let btnClass = 'btn-outline-primary';
        let iconClass = 'bi-circle';
        
        if (isAnswered) {
            if (isSelected) {
                btnClass = isCorrectAnswer ? 'btn-success' : 'btn-danger';
                iconClass = isCorrectAnswer ? 'bi-check-circle-fill' : 'bi-x-circle-fill';
            } else if (isCorrectAnswer) {
                // Show correct answer if user got it wrong
                btnClass = 'btn-outline-success';
                iconClass = 'bi-check-circle';
            }
        } else if (isSelected) {
            btnClass = 'btn-primary';
            iconClass = 'bi-check-circle-fill';
        }
        
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `btn ${btnClass} w-100 text-start mb-2 option-btn`;
        button.dataset.value = value;
        button.innerHTML = `
            <i class="bi ${iconClass} me-2"></i>
            ${option}
        `;
        
        if (!isAnswered) {
            button.addEventListener('click', () => selectAnswer(value));
        } else {
            button.disabled = true;
        }
        
        optionsForm.appendChild(button);
    });
    
    if (isSkipped) {
        optionsForm.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.remove('btn-outline-primary', 'btn-primary');
            btn.classList.add('btn-outline-primary');
            btn.querySelector('i').className = 'bi bi-dash-circle me-2';
        });
    }
}

function selectAnswer(value) {
    const question = questions[currentQuestionIndex];
    const isCorrect = value === question.answer;
    
    userAnswers[currentQuestionIndex] = {
        question: question.question,
        options: question.options,
        correctAnswer: question.answer,
        userAnswer: value,
        isSkipped: false
    };
    saveProgress();
    
    const options = document.querySelectorAll('.option-btn');
    options.forEach(option => {
        option.disabled = true;
        const optionValue = option.dataset.value;
        
        if (optionValue === question.answer) {
            option.classList.remove('btn-primary', 'btn-outline-primary');
            option.classList.add('btn-success');
            option.querySelector('i').className = 'bi bi-check-circle-fill me-2';
        } else if (optionValue === value && !isCorrect) {
            option.classList.remove('btn-primary', 'btn-outline-primary');
            option.classList.add('btn-danger');
            option.querySelector('i').className = 'bi bi-x-circle-fill me-2';
        }
    });
    
    showAlert(isCorrect ? 'Benar' : 'Salah', isCorrect ? 'success' : 'danger');
    
    if (currentQuestionIndex < questions.length - 1) {
        setTimeout(() => {
            showQuestion(currentQuestionIndex + 1);
        }, 1500);
    }
}

function skipQuestion() {
    userAnswers[currentQuestionIndex] = {
        ...questions[currentQuestionIndex],
        userAnswer: null,
        isSkipped: true
    };
    saveProgress();
    
    if (currentQuestionIndex < questions.length - 1) {
        showQuestion(currentQuestionIndex + 1);
    }
}

function showPreviousQuestion() {
    if (currentQuestionIndex > 0) {
        showQuestion(currentQuestionIndex - 1);
    }
}

function showNextQuestion() {
    if (currentQuestionIndex < questions.length - 1) {
        showQuestion(currentQuestionIndex + 1);
    }
}

function updateQuestionNumbers() {
    const container = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUESTION_NUMBERS);
    if (!container) return;
    
    container.innerHTML = '<div class="d-flex flex-wrap gap-2"></div>';
    
    questions.forEach((_, index) => {
        const answerData = userAnswers[index];
        let btnClass = 'btn-outline-secondary';
        
        if (index === currentQuestionIndex) {
            btnClass = 'btn-primary';
        } else if (answerData) {
            if (answerData.isSkipped) {
                btnClass = 'btn-danger';
            } else if (answerData.userAnswer !== null && answerData.userAnswer !== undefined) {
                btnClass = answerData.userAnswer === answerData.correctAnswer ? 'btn-success' : 'btn-success';
            }
        }
        
        container.firstChild.innerHTML += `
            <button class="btn btn-sm rounded-circle ${btnClass} question-number"
                    onclick="showQuestion(${index})">
                ${index + 1}
            </button>
        `;
    });
}

function updateProgressBar() {
    const { ELEMENT_IDS } = COMMON_QUIZ_CONFIG;
    const progress = Math.round(((currentQuestionIndex + 1) / questions.length) * 100);
    const progressBar = document.getElementById(ELEMENT_IDS.QUIZ_PROGRESS);
    progressBar.style.width = `${progress}%`;
    progressBar.setAttribute('aria-valuenow', progress);
    progressBar.textContent = `${progress}%`;
}

// Helper function to format duration
function formatDuration(ms) {
    const minutes = Math.floor(ms / 60000);
    const seconds = Math.floor((ms % 60000) / 1000);
    return `${minutes}m ${seconds}s`;
}

function calculateMaxPossibleScoreForConfig(config) {
    return config.SCORING_RULES.RANGES.reduce((total, range) => {
        return total + ((range.to - range.from + 1) * range.score);
    }, 0);
}


function startTimer() {
    clearInterval(countdownInterval);
    
    let endTime = storage.get(QUIZ_CONFIG.KEYS.END_TIME);
    
    if (!endTime) {
        const now = Date.now();
        endTime = now + QUIZ_CONFIG.DURATION;
        storage.set(QUIZ_CONFIG.KEYS.START_TIME, now);
        storage.set(QUIZ_CONFIG.KEYS.END_TIME, endTime);
    }
    
    updateTimerDisplay(endTime);
    countdownInterval = setInterval(() => updateTimerDisplay(endTime), 1000);
}

function updateTimerDisplay(endTime) {
    const now = Date.now();
    const remaining = endTime - now;

    if (remaining <= 0) {
        clearInterval(countdownInterval);
        // Check if results already exist
        const existingResults = storage.get(QUIZ_CONFIG.KEYS.RESULTS);
        if (!existingResults) {
            // If no results, force finish the quiz
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === null) {
                    userAnswers[i] = {
                        question: questions[i].question,
                        options: questions[i].options,
                        correctAnswer: questions[i].answer,
                        userAnswer: null,
                        isSkipped: true
                    };
                }
            }
            finishQuiz('expired');
        }
        return;
    }

    const totalSeconds = Math.floor(remaining / 1000);
    const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
    const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
    const seconds = String(totalSeconds % 60).padStart(2, '0');
    
    const timerElement = document.getElementById('timer');
    if (timerElement) {
        timerElement.innerHTML = `
            <span class="badge bg-danger">
                <i class="bi bi-hourglass-top me-1"></i>
                ${hours}:${minutes}:${seconds}
            </span>`;
    }
}

function formatTime(totalSeconds) {
    if (typeof totalSeconds !== 'number' || isNaN(totalSeconds) || totalSeconds < 0) {
        return '00:00:00';
    }
    
    totalSeconds = Math.floor(totalSeconds);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    
    return [
        hours.toString().padStart(2, '0'),
        minutes.toString().padStart(2, '0'),
        seconds.toString().padStart(2, '0')
    ].join(':');
}

function updateActiveQuizTimer(element, endTime) {
    if (!element || !endTime) return;
    
    const update = () => {
        const remaining = Math.max(0, endTime - Date.now());
        element.textContent = formatTime(remaining / 1000);
        
        if (remaining <= 0) {
            clearInterval(timerInterval);
            element.textContent = '00:00:00';
            element.closest('.alert')?.classList.add('alert-danger');
        }
    };
    
    const timerInterval = setInterval(update, 1000);
    update(); // Initial call
    
    // Cleanup on page navigation
    window.addEventListener('beforeunload', () => {
        clearInterval(timerInterval);
    });
}

function updateActiveQuizTimer() {
    const activeSession = getActiveQuizSession();
    if (!activeSession) return;

    const timerElements = document.querySelectorAll('#activeQuizTimer');
    if (!timerElements.length) return;

    const updateTimer = () => {
        const remaining = Math.max(0, activeSession.endTime - Date.now());
        const formattedTime = formatTime(remaining / 1000);
        
        timerElements.forEach(el => {
            if (el) el.textContent = formattedTime;
        });

        if (remaining <= 0) {
            clearInterval(timerInterval);
            // Optional: Refresh the page when time expires
            setTimeout(() => window.location.reload(), 1000);
        }
    };

    const timerInterval = setInterval(updateTimer, 1000);
    updateTimer(); // Initial call
}

function saveProgress() {
    const { KEYS } = QUIZ_CONFIG;
    storage.set(KEYS.USER_ANSWERS, userAnswers);
    storage.set(KEYS.CURRENT_QUESTION, currentQuestionIndex);
    
    if (!storage.get(KEYS.END_TIME)) {
        const now = Date.now();
        storage.set(KEYS.START_TIME, now);
        storage.set(KEYS.END_TIME, now + QUIZ_CONFIG.DURATION);
    }
}

function loadProgress() {
    const { KEYS } = QUIZ_CONFIG;
    
    userAnswers = Array(QUIZ_CONFIG.QUESTION_COUNT).fill(null);
    
    const savedAnswers = storage.get(KEYS.USER_ANSWERS);
    if (Array.isArray(savedAnswers)) {
        savedAnswers.forEach((answer, index) => {
            if (index < userAnswers.length && answer !== null) {
                userAnswers[index] = answer;
            }
        });
    }
    
    const savedIndex = parseInt(storage.get(KEYS.CURRENT_QUESTION)) || 0;
    currentQuestionIndex = Math.min(Math.max(savedIndex, 0), questions.length - 1);
}

function finishQuiz(status) {
    // Hitung jumlah soal yang belum dijawab
    const unansweredCount = userAnswers.filter(a => a === null || a?.isSkipped).length;
    const allAnswered = unansweredCount === 0;
    
    // Jika semua soal telah dijawab DAN waktu masih tersisa, hentikan timer
    if (allAnswered && !isTimeExpired()) {
        clearInterval(countdownInterval);
        
        // Simpan waktu yang tersisa sebagai waktu yang digunakan
        const startTime = storage.get(QUIZ_CONFIG.KEYS.START_TIME);
        const timeTaken = Math.floor((Date.now() - parseInt(startTime)) / 1000);
        storage.set(QUIZ_CONFIG.KEYS.END_TIME, Date.now()); // Set end time to now
    }
    // Jika masih ada soal yang belum dijawab, biarkan timer berjalan
    
    const completeAnswers = questions.map((question, index) => {
        return userAnswers[index] || {
            question: question.question,
            options: question.options,
            correctAnswer: question.answer,
            userAnswer: null,
            isSkipped: true
        };
    });

    const resultData = {
        answers: completeAnswers,
        score: calculateScore(),
        maxScore: calculateMaxPossibleScore(),
        percentage: calculatePercentageScore(),
        timeTaken: calculateTimeTaken(),
        completedAt: new Date().toISOString(),
        status: status || 'completed',
        allAnswered: allAnswered // Tambahkan flag apakah semua soal telah dijawab
    };
    
    storage.set(QUIZ_CONFIG.KEYS.RESULTS, resultData);
    
    // Force show results page
    const params = new URLSearchParams(window.location.search);
    params.set('view', 'results');
    window.location.search = params.toString();
}

function showResults() {
    if (isShowingResults) return;
    isShowingResults = true;

    const { ELEMENT_IDS } = COMMON_QUIZ_CONFIG;

    document.getElementById(ELEMENT_IDS.LANDING_PAGE_CONTAINER).style.display = 'none';
    document.getElementById(ELEMENT_IDS.QUIZ_CONTENT_CONTAINER).style.display = 'none';
    
    const result = storage.get(QUIZ_CONFIG.KEYS.RESULTS);
    const resultContainer = document.getElementById(ELEMENT_IDS.RESULT_CONTAINER);
    const noResultsAlert = document.getElementById(ELEMENT_IDS.NO_RESULT_ALERT);
    
    resultContainer.style.display = 'block';

    if (!result || !result.answers || !Array.isArray(result.answers)) {
        console.error('Invalid results format:', result);
        noResultsAlert.classList.remove('d-none');
        document.getElementById(ELEMENT_IDS.RESULT_SUMMARY).style.display = 'none';
        document.getElementById(ELEMENT_IDS.ANSWER_LIST).style.display = 'none';
        
        const params = new URLSearchParams(window.location.search);
        params.set('view', 'results');
        window.history.replaceState({}, '', `?${params.toString()}`);
        
        return;
    }

    noResultsAlert.classList.add('d-none');
    document.getElementById(ELEMENT_IDS.RESULT_SUMMARY).style.display = 'block';
    document.getElementById(ELEMENT_IDS.ANSWER_LIST).style.display = 'block';

    const params = new URLSearchParams(window.location.search);
    params.set('view', 'results');
    window.history.replaceState({}, '', `?${params.toString()}`);

    const totalQuestions = result.answers.length;
    let correctCount = 0;
    let wrong = 0;
    let skipped = 0;

    result.answers.forEach((ans) => {
        const isCorrect = ans.userAnswer === ans.correctAnswer;
        const isSkipped = ans.userAnswer === null;
        
        if (isSkipped) {
            skipped++;
        } else if (isCorrect) {
            correctCount++;
        } else {
            wrong++;
        }
    });

    const totalScore = result.score;
    const percentage = result.percentage;
    const grade = getGrade(totalScore);
    const isPassed = totalScore >= QUIZ_CONFIG.PASSING_SCORE;
    const timeUsed = result.timeTaken;
    const completedAt = new Date(result.completedAt);
    const timeRemaining = getRemainingTime();
    const isExpired = isTimeExpired();

document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.RESULT_SUMMARY).innerHTML = `
    <div class="card shadow-sm bg-light print-header">
        <div class="card-body">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="${QUIZ_CONFIG.HOMEPAGE_URL}">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.BERANDA}</a></li>
          <li class="breadcrumb-item text-truncate"><a href="${QUIZ_CONFIG.QUIZ_URL}">${QUIZ_CONFIG.QUIZ_TITLE}</a></li>
          <li class="breadcrumb-item active text-truncate" aria-current="page">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.HASIL_PENCAPAIAN}</li>
        </ol>
      </nav>
            <div class="d-flex justify-content-between mb-3">
            <h4 class="h4">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.HASIL_PENCAPAIAN}</h4>
            </div>
            <div class="hstack gap-3 mb-2 small text-center">
                <div class="p-0">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.SKOR}/${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.POIN}: <span class="badge text-bg-info border">${totalScore} / ${calculateMaxPossibleScore()}</span></div>
                <div class="p-0 ms-auto">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.NILAI} (%): <span class="badge ${percentage >= QUIZ_CONFIG.PASSING_SCORE ? 'text-bg-success' : 'text-bg-danger'} border">${percentage}%</span></div>  
                <div class="p-0">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.GRADE}: <span class="badge ${isPassed ? 'text-bg-success' : 'text-bg-danger'} border">${grade}</span></div>
                <div class="p-0">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.STATUS}: <span class="badge ${isPassed ? 'text-bg-success' : 'text-bg-danger'} border">
                    ${isPassed ? 'Lulus' : 'Tidak Lulus'}
                </span></div>
            </div>
            <ul class="list-group list-group-horizontal text-center mb-3">
             <li class="list-group-item flex-fill border-success text-success" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Jumlah Jawaban Benar">
              ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JAWABAN_BENAR} <span class="badge text-bg-success border">${correctCount}</span>
             </li>
             <li class="list-group-item flex-fill border-danger text-danger" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Jumlah Jawaban Salah">
              ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JAWABAN_SALAH} <span class="badge text-bg-danger border">${wrong}</span>
             </li>
             <li class="list-group-item flex-fill border-secondary text-secondary" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Jumlah Soal Dilewati/Tidak dijawab">
              ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JAWABAN_DILEWATI} <span class="badge text-bg-secondary border">${skipped}</span>
             </li>
            </ul>
            <div class="d-flex justify-content-between d-none">
                <button type="button" class="btn btn-outline-success mb-2" data-bs-toggle="tooltip" data-bs-title="Jumlah Jawaban Benar">
                    ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JAWABAN_BENAR} <span class="badge text-bg-success border">${correctCount}</span>
                </button> 
                <button type="button" class="btn btn-outline-danger mb-2" data-bs-toggle="tooltip" data-bs-title="Jumlah Jawaban Salah">
                    ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JAWABAN_SALAH} <span class="badge text-bg-danger border">${wrong}</span>
                </button>    
                <button type="button" class="btn btn-outline-secondary mb-2" data-bs-toggle="tooltip" data-bs-title="Jumlah Jawaban Dilewati">
                    ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JAWABAN_DILEWATI} <span class="badge text-bg-secondary border">${skipped}</span>
                </button>
            </div>
            <p class="card-text small text-muted">
                ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JUMLAH_SOAL} : <span class="badge text-bg-success border">${QUIZ_CONFIG.QUESTION_COUNT}</span> <br>
                ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.NILAI_MINIMAL_LULUS}: <span class="badge text-bg-warning border">${QUIZ_CONFIG.PASSING_SCORE}</span> dari <span class="badge text-bg-success border">${QUIZ_CONFIG.MAX_SCORE}</span><br>
                ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.TANGGAL_PENGERJAAN}: <strong>${formatDateTime(completedAt)}</strong><br>
                ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.WAKTU_DIHABISKAN}: <strong>${formatTime(timeUsed)}</strong><br>
                ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.WAKTU_TERSISA}: <strong>${isExpired ? '0 menit 0 detik' : formatTime(timeRemaining)}</strong>
                ${isExpired ? '<span class="text-danger"> (Waktu ujian telah habis)</span>' : ''} 
            </p>
            ${!isPassed ? `
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i> Anda belum mencapai nilai minimal kelulusan.
                </div>
            ` : ''}

            <button class="btn btn-sm btn-light no-print"
             onclick="window.print()"><i class="bi bi-download"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.CETAK_HASIL}</button>

            <button onclick="continueQuiz()" class="btn btn-sm btn-light ${isExpired ? 'disabled' : ''}" 
                ${isExpired ? 'disabled' : ''}>
                <i class="bi bi-pencil-square"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.EDIT}/${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.LANJUTKAN_KUIS}
            </button>

            <button onclick="showUniversalModal('reset')" class="btn btn-sm btn-light">
                <i class="bi bi-arrow-counterclockwise"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.RESET}
            </button>
        </div>
    </div>
`;


    const allAnswered = result.allAnswered;
    
    const timeInfoHTML = `
        <div class="d-flex justify-content-between align-items-center small text-muted">
            <span>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.WAKTU_DIHABISKAN}:</span>
            <span><strong>${formatTime(result.timeTaken)}</strong></span>
        </div>
        <div class="d-flex justify-content-between align-items-center small text-muted">
            <span>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.WAKTU_TERSISA}:</span>
            <span><strong>${isExpired ? '0 menit 0 detik' : formatTime(getRemainingTime())}</strong></span>
        </div>
        ${!isExpired && !allAnswered ? `
        <div class="alert alert-info mt-2 small">
            <i class="bi bi-info-circle"></i> Masih ada waktu tersisa dan soal yang belum dijawab. 
            Anda dapat melanjutkan kuis dengan menekan tombol <strong>Edit/Lanjutkan</strong>.
        </div>
        ` : ''}
    `;

    const list = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.ANSWER_LIST);
    list.innerHTML = result.answers.map((ans, index) => {
        const question = questions[index];
        const questionNumber = index + 1;
        const userAns = (ans.userAnswer || "").trim().toUpperCase();
        const correctAns = (ans.correctAnswer || "").trim().toUpperCase();
        const isCorrect = userAns === correctAns;
        const isSkipped = ans.userAnswer === null;
        const poinLabel = isCorrect ? `1 poin` : `0 poin`;
        const badgeClass = isSkipped ? 'bg-secondary' : isCorrect ? 'bg-success' : 'bg-danger';

        const optionsHTML = ans.options.map(opt => {
            const val = opt.split(".")[0].trim().toUpperCase();
            let className = "list-group-item d-flex justify-content-between align-items-center";
            let iconHTML = "";

            if (val === userAns) {
                if (isSkipped) {
                    className += " list-group-item-secondary";
                } else if (isCorrect) {
                    className += " list-group-item-success";
                    iconHTML = `<i class="bi bi-check-circle-fill"></i>`;
                } else {
                    className += " list-group-item-danger";
                    iconHTML = `<i class="bi bi-x-circle-fill"></i>`;
                }
            } else if (val === correctAns) {
                className += " list-group-item-success border-start border-0 border-success";
            }

            return `<li class="${className}">${opt} ${iconHTML}</li>`;
        }).join("");

return `
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.SOAL} ${questionNumber}</h5>
                <span>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.NILAI} ${getQuestionPointsBadge(questionNumber)}</span>
            </div>
            <p>${ans.question}</p>
            ${question.image ? `
            <div class="question-image-container mt-3 mb-4 text-center">
                <img src="/assets/images/pelatihan/${question.image}" alt="Gambar soal" class="img-fluid rounded border">
            </div>
            ` : ''}
            <ul class="list-group mb-3">${optionsHTML}</ul>
            <div class="alert small ${isSkipped ? 'alert-secondary' : isCorrect ? 'bg-success-subtle' : 'bg-danger-subtle'}">
                ${
                    isSkipped
                        ? `<span>Soal dilewati/tidak dijawab. Poin yang Anda peroleh adalah <span class="badge bg-secondary small">0 poin</span></span>`
                        : isCorrect
                            ? `<span>Jawaban Anda Benar. Poin yang Anda peroleh adalah ${getQuestionPointsBadge(questionNumber, true)}</span>`
                            : `<span>Jawaban Anda Salah. Poin yang Anda peroleh adalah <span class="badge bg-danger small">0 poin</span></span>`
                }
                <br>
                Jawaban yang tepat adalah <span class="badge text-bg-success">${question.answer}</span> (${getFullAnswerText(question.answer, question.options)})
            </div>
        </div>
    </div>
`;
    }).join("");

    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
        new bootstrap.Tooltip(el);
    });
}

function getFullAnswerText(answerLetter, options) {
    if (!answerLetter || !options) return '';
    
    const correctOption = options.find(opt => 
        opt.trim().toUpperCase().startsWith(`${answerLetter.toUpperCase()}.`)
    );
    
    return correctOption ? correctOption.substring(correctOption.indexOf('.') + 1).trim() : '';
}

const startQuizBtn = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.STAT_QUIZ_BUTTON);
if (startQuizBtn) {
    startQuizBtn.addEventListener('click', function() {
        startQuiz(0);
    });
}

const resetBtnOnResults = document.querySelector('#resultSummary button[onclick*="showUniversalModal(\'reset\')"]');
if (resetBtnOnResults) {
    resetBtnOnResults.addEventListener('click', function() {
        showUniversalModal('reset');
    });
}

// Time Management Functions
function isTimeExpired() {
    const endTime = storage.get(QUIZ_CONFIG.KEYS.END_TIME);
    return endTime ? Date.now() >= endTime : false;
}

function getRemainingTime() {
    const endTime = storage.get(QUIZ_CONFIG.KEYS.END_TIME);
    if (!endTime) return QUIZ_CONFIG.DURATION / 1000;
    return Math.max(0, Math.floor((endTime - Date.now()) / 1000));
}

function formatTime(seconds) {
    // Ensure seconds is a valid number
    seconds = Math.max(0, Math.floor(Number(seconds)) || 0);
    
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    // Format as "X jam Y menit Z detik"
    const parts = [];
    if (hours > 0) parts.push(`${hours} jam`);
    if (minutes > 0 || hours > 0) parts.push(`${minutes} menit`);
    parts.push(`${secs} detik`);
    
    return parts.join(' ');
}

function calculateTimeTaken() {
    const startTime = storage.get(QUIZ_CONFIG.KEYS.START_TIME);
    if (!startTime) return 0;
    
    const endTime = storage.get(QUIZ_CONFIG.KEYS.END_TIME);
    const now = Date.now();
    
    // Gunakan waktu sekarang jika:
    // 1. Waktu sudah habis, atau
    // 2. Semua soal telah dijawab (endTime di-set ke waktu sekarang saat finishQuiz)
    const actualEndTime = isTimeExpired() || (endTime && endTime <= now) ? 
        Math.min(endTime || now, now) : 
        now;
    
    const elapsedSeconds = Math.floor((actualEndTime - parseInt(startTime)) / 1000);
    const maxDurationSeconds = QUIZ_CONFIG.DURATION / 1000;
    return Math.min(elapsedSeconds, maxDurationSeconds);
}

function formatDateTime(date) {
    return date.toLocaleString('id-ID', {
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit', 
        minute: '2-digit'
    });
}

function getQuestionPointsBadge(questionNumber, isSmall = false) {
    const range = QUIZ_CONFIG.SCORING_RULES.RANGES.find(r => 
        questionNumber >= r.from && questionNumber <= r.to
    );
    const points = range?.score || QUIZ_CONFIG.SCORING_RULES.DEFAULT_SCORE;
    const sizeClass = isSmall ? 'small' : '';
    
    return `<span class="badge bg-primary ${sizeClass}">${points} Poin</span>`;
}

function getQuestionScore(index) {
    const questionNumber = index + 1;
    const range = QUIZ_CONFIG.SCORING_RULES.RANGES.find(r => 
        questionNumber >= r.from && questionNumber <= r.to
    );
    return range?.score || QUIZ_CONFIG.SCORING_RULES.DEFAULT_SCORE;
}

function calculateScore() {
    return userAnswers.reduce((score, answer, index) => {
        if (answer && answer.userAnswer === answer.correctAnswer) {
            const questionNumber = index + 1;
            const range = QUIZ_CONFIG.SCORING_RULES.RANGES.find(r => 
                questionNumber >= r.from && questionNumber <= r.to
            );
            return score + (range?.score || QUIZ_CONFIG.SCORING_RULES.DEFAULT_SCORE);
        }
        return score;
    }, 0);
}

function calculateMaxPossibleScore() {
    return QUIZ_CONFIG.SCORING_RULES.RANGES.reduce((total, range) => {
        return total + ((range.to - range.from + 1) * range.score);
    }, 0);
}

function calculatePercentageScore() {
    const score = calculateScore();
    return Math.round((score / questions.length) * 100);
}

function getGrade(score) {
    if (score >= QUIZ_CONFIG.MAX_SCORE * 0.85) return "A (Sangat Baik)";
    if (score >= QUIZ_CONFIG.MAX_SCORE * 0.70) return "B (Baik)";
    if (score >= QUIZ_CONFIG.PASSING_SCORE) return "C (Cukup)";
    return "D (Kurang)";
}

function getAllActiveSessions() {
    const activeSessions = [];
    
    for (const [quizId, config] of Object.entries(QUIZ_CONFIGS)) {
        try {
            const endTime = localStorage.getItem(`${config.STORAGE_KEY}_${config.KEYS.END_TIME}`);
            const results = localStorage.getItem(`${config.STORAGE_KEY}_${config.KEYS.RESULTS}`);
            
            if (endTime && !results) {
                const remainingTime = parseInt(endTime) - Date.now();
                if (remainingTime > 0) {
                    activeSessions.push({
                        quizId,
                        config,
                        remainingTime,
                        endTime: parseInt(endTime),
                        currentQuestion: parseInt(localStorage.getItem(`${config.STORAGE_KEY}_${config.KEYS.CURRENT_QUESTION}`)) || 0,
                        quizTitle: config.QUIZ_TITLE,
                        quizUrl: `/pelatihan/modul/?id=${quizId}`
                    });
                }
            }
        } catch (e) {
            console.error("Error checking quiz session:", e);
        }
    }
    
    return activeSessions;
}

function updateActiveQuizzesBadge() {
    const badge = document.getElementById('activeQuizzesBadge');
    if (!badge) return;  // Safety check
    
    const activeSessions = getAllActiveSessions(); // Now this will work
    
    if (activeSessions.length > 0) {
        badge.textContent = activeSessions.length;
        badge.classList.remove('d-none');
    } else {
        badge.classList.add('d-none');
    }
}

function showAlert(message, type) {
    const { ELEMENT_IDS } = COMMON_QUIZ_CONFIG;
    const toast = document.getElementById(ELEMENT_IDS.ALERT_BOX);
    const msg = document.getElementById(ELEMENT_IDS.ALERT_MESSAGE);
    
    toast.classList.remove(
        'bg-success', 'bg-danger', 'bg-warning', 
        'bg-primary', 'bg-info', 'd-none'
    );
    
    toast.classList.add(`bg-${type}`, 'text-white');
    msg.textContent = message;
    
    toast.style.display = 'block';
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    setTimeout(() => bsToast.hide(), 2500);
}

function initializeQuiz() {
    const { KEYS } = QUIZ_CONFIG;
    
    try {
        clearInterval(countdownInterval);
        startTimer();
        
        const urlParams = new URLSearchParams(window.location.search);
        const soalParam = urlParams.get('soal');
        
        if (soalParam && !isNaN(soalParam)) {
            currentQuestionIndex = Math.min(Math.max(parseInt(soalParam) - 1, 0), questions.length - 1);
        } else {
            currentQuestionIndex = parseInt(storage.get(KEYS.CURRENT_QUESTION)) || 0;
        }
        
        // Force update URL to match current question
        updateURL();
        
        // Ensure proper visibility
        document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.LANDING_PAGE_CONTAINER).style.display = 'none';
        document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.RESULT_CONTAINER).style.display = 'none';
        document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_CONTENT_CONTAINER).style.display = 'block';
        
    clearInterval(countdownInterval);
    startTimer();
    showQuestion(currentQuestionIndex);
    updateQuestionNumbers();
    updateProgressBar();

    } catch (error) {
        console.error("Error initializing quiz:", error);
        storage.clear();
        window.location.href = window.location.pathname;
    }
}

function continueQuiz() {
    // First ensure the quiz container exists and is populated
    const quizContentContainer = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.QUIZ_CONTENT_CONTAINER);
    if (!quizContentContainer.innerHTML) {
        quizContentContainer.innerHTML = QuizContainer();
        setupQuizEventListeners(); // Reinitialize event listeners
    }

    // Load progress and update state
    loadProgress();
    storage.remove(QUIZ_CONFIG.KEYS.RESULTS);

    // Update URL
    const params = new URLSearchParams(window.location.search);
    params.delete('view');
    params.set('soal', currentQuestionIndex + 1);
    window.history.replaceState({}, '', `?${params.toString()}`);

    // Toggle visibility
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.RESULT_CONTAINER).style.display = 'none';
    quizContentContainer.style.display = 'block';

    // Force redraw
    setTimeout(() => {
        initializeQuiz(); // Properly reinitialize the quiz
    }, 50);
}

function initializeQuiz() {
    const { ELEMENT_IDS } = COMMON_QUIZ_CONFIG;
    
    try {
        // Ensure required elements exist
        const questionTextElement = document.getElementById(ELEMENT_IDS.QUESTION_TEXT);
        const optionsForm = document.getElementById(ELEMENT_IDS.OPTIONS_FORM);
        const currentQuestionNumber = document.getElementById(ELEMENT_IDS.CURRENT_QUESTION_NUMBER);
        
        if (!questionTextElement || !optionsForm || !currentQuestionNumber) {
            console.error('Required elements not found');
            return;
        }

        clearInterval(countdownInterval);
        startTimer();
        
        const urlParams = new URLSearchParams(window.location.search);
        const soalParam = urlParams.get('soal');
        
        if (soalParam && !isNaN(soalParam)) {
            currentQuestionIndex = Math.min(Math.max(parseInt(soalParam) - 1, 0), questions.length - 1);
        } else {
            currentQuestionIndex = parseInt(storage.get(QUIZ_CONFIG.KEYS.CURRENT_QUESTION)) || 0;
        }
        
        updateURL();
        showQuestion(currentQuestionIndex);
        updateQuestionNumbers();
        updateProgressBar();

    } catch (error) {
        console.error("Error initializing quiz:", error);
        storage.clear();
        window.location.href = window.location.pathname;
    }
}

function resetQuiz() {
    showUniversalModal('reset');
}

const universalModal = new bootstrap.Modal(document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.UNIVERSAL_MODAL));

function showUniversalModal(type) {
    // Get modal elements
    const modalTitle = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.UNIVERSAL_MODAL_TITLE);
    const modalBody = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.UNIVERSAL_MODAL_BODY);
    const modalFooter = document.querySelector('#universalModal .modal-footer');
    
    // Set default footer buttons
    modalFooter.innerHTML = `
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary" id="universalModalConfirmBtn">Konfirmasi</button>
    `;
    
    const confirmBtn = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.UNIVERSAL_MODAL_CONFIRM_BUTTON);

    // Handle different modal types
    switch (type) {
        case 'abandon-quiz':
            setupAbandonQuizModal(modalTitle, modalBody, confirmBtn);
            break;
            
        case 'clear-data':
            setupClearDataModal(modalTitle, modalBody, confirmBtn);
            break;
            
        case 'reset':
            setupResetModal(modalTitle, modalBody, confirmBtn);
            break;
            
        case 'give-up':
            setupGiveUpModal(modalTitle, modalBody, confirmBtn);
            break;
            
        case 'finish':
            setupFinishModal(modalTitle, modalBody, confirmBtn);
            break;
            
        case 'help':
            setupHelpModal(modalTitle, modalBody, modalFooter);
            break;
    }

    universalModal.show();
}

// Helper functions for each modal type
function setupAbandonQuizModal(modalTitle, modalBody, confirmBtn) {
    const activeSession = getActiveQuizSession();
    
    modalTitle.textContent = 'Batalkan Ujian';
    modalTitle.parentElement.className = 'modal-header bg-warning';
    modalBody.innerHTML = `
        <p>Anda yakin ingin membatalkan quiz yang sedang berjalan?</p>
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle-fill"></i> 
            Semua progress dan jawaban akan dihapus dan waktu akan direset.
        </div>
        <p><strong>Quiz:</strong> ${activeSession.quizTitle}</p>
        <p><strong>Waktu tersisa:</strong> ${formatTime(activeSession.remainingTime / 1000)}</p>
    `;
    
    confirmBtn.className = 'btn btn-danger';
    confirmBtn.innerHTML = '<i class="bi bi-x-circle"></i> Ya, Batalkan';
    confirmBtn.onclick = function() {
        // Clear the specific quiz data
        const config = QUIZ_CONFIGS[activeSession.quizId];
        Object.values(config.KEYS).forEach(key => {
            localStorage.removeItem(`${config.STORAGE_KEY}_${key}`);
        });
        
        showAlert('Quiz telah dibatalkan', 'success');
        setTimeout(() => window.location.reload(), 1000);
        universalModal.hide();
    };
}

function setupClearDataModal(modalTitle, modalBody, confirmBtn) {
    modalTitle.textContent = 'Konfirmasi Penghapusan Data';
    modalTitle.parentElement.className = 'modal-header bg-danger text-white';
    modalBody.innerHTML = `
        <p>Anda yakin ingin menghapus SEMUA data yang tersimpan di browser ini?</p>
        <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle-fill"></i> 
            Aksi ini tidak dapat dibatalkan! Semua data termasuk jawaban quiz dan hasil akan dihapus permanen.
        </div>
    `;
    
    confirmBtn.className = 'btn btn-danger';
    confirmBtn.innerHTML = '<i class="bi bi-trash"></i> Ya, Hapus Semua';
    confirmBtn.onclick = function() {
        // Clear all quiz data from all quizzes
        Object.keys(QUIZ_CONFIGS).forEach(quizId => {
            const config = QUIZ_CONFIGS[quizId];
            Object.values(config.KEYS).forEach(key => {
                localStorage.removeItem(`${config.STORAGE_KEY}_${key}`);
            });
        });
        
        // Clear profile data
        localStorage.removeItem('userProfile');
        
        // Show success message
        showAlert('Semua data telah dihapus!', 'success');
        
        // Redirect to home after a delay
        setTimeout(() => {
            window.location.href = '/pelatihan/modul/';
        }, 1500);
        
        universalModal.hide();
    };
}

function setupResetModal(modalTitle, modalBody, confirmBtn) {
    modalTitle.textContent = 'Reset Quiz';
    modalTitle.parentElement.className = 'modal-header bg-danger text-white';
    modalBody.innerHTML = `
        <p>Anda yakin ingin memulai ulang seluruh quiz?</p>
        <ul class="text-danger">
            <li>Semua jawaban akan dihapus</li>
            <li>Waktu akan direset ke 120 menit</li>
            <li>Progress saat ini akan hilang permanen</li>
        </ul>
    `;
    
    confirmBtn.className = 'btn btn-danger';
    confirmBtn.innerHTML = '<i class="bi bi-trash"></i> Reset';
    confirmBtn.onclick = function() {
        // Clear all quiz data
        storage.clear();
        currentQuestionIndex = 0;
        userAnswers = Array(QUIZ_CONFIG.QUESTION_COUNT).fill(null);
        clearInterval(countdownInterval);
        
        // Get current quiz ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const quizId = urlParams.get('id');
        
        // COMPLETELY RESET URL PARAMETERS while maintaining quiz ID
        const cleanUrl = window.location.pathname + `?id=${quizId}`;
        window.history.replaceState({}, '', cleanUrl);
        
        universalModal.hide();
        
        // Simply reload the page to ensure clean state
        window.location.reload();
    };
}

function setupGiveUpModal(modalTitle, modalBody, confirmBtn) {
    modalTitle.textContent = 'Konfirmasi';
    modalTitle.parentElement.className = 'modal-header bg-warning';
    modalBody.innerHTML = 'Apakah Anda yakin ingin menyerah dan melihat hasil saat ini?';
    
    confirmBtn.className = 'btn btn-danger';
    confirmBtn.textContent = 'Ya, Saya Yakin';
    confirmBtn.onclick = function() {
        for (let i = 0; i < questions.length; i++) {
            if (userAnswers[i] === null) {
                userAnswers[i] = {
                    question: questions[i].question,
                    options: questions[i].options,
                    correctAnswer: questions[i].answer,
                    userAnswer: null,
                    isSkipped: true
                };
            }
        }
        
        saveProgress();
        finishQuiz('gave-up'); 
        const params = new URLSearchParams(window.location.search);
        params.set('view', 'results');
        window.location.search = params.toString();
        universalModal.hide();
    };
}

function setupFinishModal(modalTitle, modalBody, confirmBtn) {
    const unansweredCount = userAnswers.filter(a => a === null || a?.isSkipped).length;
    
    modalTitle.textContent = 'Konfirmasi Penyelesaian Kuis';
    modalTitle.parentElement.className = 'modal-header bg-warning';
    modalBody.innerHTML = unansweredCount > 0 ? `
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle-fill"></i> 
            Masih ada <strong>${unansweredCount} soal</strong> yang belum dijawab!
        </div>
        <p>Anda yakin ingin menyelesaikan kuis sekarang?</p>
        <p class="text-muted small">Catatan: Soal yang belum dijawab/dilewati akan dihitung sebagai salah dan mendapat nilai 0 (Nol) poin.</p>
    ` : '<p>Semua soal telah dijawab. Anda yakin ingin menyelesaikan kuis sekarang?</p>';
    
    confirmBtn.className = 'btn btn-primary';
    confirmBtn.textContent = 'Ya, Selesaikan';
    confirmBtn.onclick = function() {
        finishQuiz('completed');
        const params = new URLSearchParams(window.location.search);
        params.set('view', 'results');
        window.location.search = params.toString();
        universalModal.hide();
    };
}

function setupHelpModal(modalTitle, modalBody, modalFooter) {
    modalTitle.textContent = 'Informasi';
    modalTitle.parentElement.className = 'modal-header bg-info text-white';
    modalBody.innerHTML = `
        <table class="table table-sm caption-top">
            <caption>Fungsi Elemen</caption>
            <thead>
                <tr>
                    <th scope="col">Elemen</th>
                    <th scope="col">Fungsi</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="fw-bold">
                        <span class="bi bi-arrow-counterclockwise"> Reset</span>
                    </td>
                    <td>
                        Untuk menghapus semua jawaban dan waktu secara permanen.
                    </td>
                </tr>
                <tr>
                    <td class="fw-bold">
                        <span class="bi bi-pencil-square"> Edit</span>
                    </td>
                    <td>
                        Untuk kembali ke halaman soal dan mengisi soal yang belum dijawab. Ini berlaku selama waktu masih tersisa. 
                        Jika waktu telah habis, tidak bisa diedit lagi. Anda dapat menekan 
                        tombol "<span class="fw-bold bi bi-arrow-counterclockwise"> Reset</span>" 
                        untuk memulai ulang dari awal lagi.
                    </td>
                </tr>
                <tr>
                    <td class="fw-bold">
                        <span class="bi bi-download"> Cetak Hasil</span>
                    </td>
                    <td>
                        Untuk mencetak hasil dan mengunduhnya ke dalam format PDF.
                    </td>
                </tr>
            </tbody>
        </table>
    `;
    
    modalFooter.innerHTML = `
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
            <i class="bi bi-check-circle"></i> Mengerti
        </button>
    `;
}

function createLandingPage() {
    const result = storage.get(QUIZ_CONFIG.KEYS.RESULTS);
    const hasPreviousResults = result && result.score !== undefined;
    
    // Get current quiz's active session (if exists and not expired)
    const activeSessions = getActiveQuizSessions();
    const currentQuizActive = activeSessions.find(session => {
        return session.storageKey === QUIZ_CONFIG.STORAGE_KEY && 
               Date.now() < session.endTime;
    });

    // Determine button text
    let mainButtonText, mainButtonIcon;
    if (currentQuizActive) {
        mainButtonText = 'Lanjutkan';
        mainButtonIcon = 'bi-arrow-return-right';
    } else if (hasPreviousResults) {
        mainButtonText = 'Lihat Hasil';
        mainButtonIcon = 'bi-eye-fill';
    } else {
        mainButtonText = 'Mulai Sekarang';
        mainButtonIcon = 'bi-play-fill';
    }

    return `
    <div class="landing-page">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="${QUIZ_CONFIG.HOMEPAGE_URL}">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.BERANDA}</a></li>
          <li class="breadcrumb-item active text-truncate" aria-current="page">${QUIZ_CONFIG.QUIZ_TITLE}</li>
        </ol>
      </nav>
      <h3>${QUIZ_CONFIG.QUIZ_TITLE}</h3>

      ${hasPreviousResults ? `
        <div class="card mb-4 mt-3 border-primary bg-light">
          <div class="card-body">
            <h5 class="card-title"><i class="bi bi-clock-history"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.HASIL_SEBELUMNYA}</h5>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.SKOR}:</span>
              <span class="badge ${result.score >= QUIZ_CONFIG.PASSING_SCORE ? 'bg-success' : 'bg-danger'}">
                ${result.score}/${calculateMaxPossibleScore()}
              </span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.STATUS}:</span>
              <span class="badge ${result.score >= QUIZ_CONFIG.PASSING_SCORE ? 'bg-success' : 'bg-danger'}">
                ${result.score >= QUIZ_CONFIG.PASSING_SCORE ? 'LULUS' : 'TIDAK LULUS'}
              </span>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <span>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.TANGGAL_PENGERJAAN}:</span>
              <span>${new Date(result.completedAt).toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
              })}</span>
            </div>
            <p class="text-muted small p-0 m-0 mt-3">Hasil ini hanya tampil jika Anda pernah mengerjakan soal ini sebelumnya dan hanya Anda yang dapat melihatnya. Tekan tombol Reset dibawah untuk menghapus skor/hasil ini secara permanen dan untuk memulai ulang menjawab soal.</p>
          </div>
        </div>
      ` : ''}
      
      ${currentQuizActive ? `
        <div class="card mb-4 border-warning">
          <div class="card-body">
              <h5 class="card-title"><i class="bi bi-hourglass-split"></i> Kuis Berjalan</h5>
              <div class="d-flex justify-content-between align-items-center mb-2">
                  <span>Status:</span>
                  <span class="badge bg-warning text-dark">Dalam Progres</span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                  <span>Waktu tersisa:</span>
                  <span class="badge bg-danger">${formatTime((currentQuizActive.endTime - Date.now()) / 1000)}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                  <span>Soal terakhir:</span>
                  <span class="badge bg-primary">${currentQuizActive.currentQuestion + 1}/${QUIZ_CONFIG.QUESTION_COUNT}</span>
              </div>
          </div>
        </div>
      ` : ''}

      <ul class="list-group text-left mt-${hasPreviousResults || currentQuizActive ? '2' : '4'}">
        <li class="list-group-item d-flex justify-content-between align-items-center">
          ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JENIS_SOAL}: <span class="badge text-bg-primary rounded-pill">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.PILIHAN_GANDA}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center" id="questionCount">
          ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JUMLAH_SOAL}: <span class="badge text-bg-primary rounded-pill">${QUIZ_CONFIG.QUESTION_COUNT}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.WAKTU_PENGERJAAN}: <span class="badge text-bg-primary rounded-pill">120 Menit</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.PASSING_GRADE}: <span class="badge text-bg-primary rounded-pill">${QUIZ_CONFIG.PASSING_SCORE} dari ${QUIZ_CONFIG.MAX_SCORE}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">Sumber soal: <a href="${QUIZ_CONFIG.SUMBER_SOAL}" target="_blank" rel="nofollow"><span class="badge quiz-question-count">Klik disini <i class="bi bi-box-arrow-up-right"></i></span></a></li>
      </ul>

      <table class="table table-success table-striped-columns mt-3 caption-top">
        <caption>Perhitungan Nilai</caption>
        <thead>
          <tr>
            <th>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JENIS_SOAL}</th>
            <th>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JUMLAH_SOAL}</th>
            <th>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.NILAI}</th>
          </tr>
        </thead>
        <tbody>
          ${QUIZ_CONFIG.SCORING_RULES.RANGES.map(range => {
            const count = range.to - range.from + 1;
            return `
              <tr>
                <td>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.PILIHAN_GANDA}</td>
                <td>${range.from}-${range.to} (${count})</td>
                <td>${count} * ${range.score} = ${count * range.score}</td>
              </tr>
            `;
          }).join('')}
        </tbody>
        <thead>
          <tr>
            <th>${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.JUMLAH}</th>
            <th>${QUIZ_CONFIG.QUESTION_COUNT}</th>
            <th>${QUIZ_CONFIG.MAX_SCORE}</th>
          </tr>
        </thead>
      </table>
      <p class="p-0 m-0"><i class="bi bi-check-circle"></i> Nilai Jawaban Salah/Dilewati/Tidak dijawab adalah 0 (Nol) poin.</p>
      <p class="p-0 m-0"><i class="bi bi-check-circle"></i> Tidak menjawab soal dalam waktu yang ditentukan akan dianggap selesai.</p>
      <p class="p-0 m-0"><i class="bi bi-check-circle"></i> Waktu habis, tidak bisa mengedit jawaban kecuali waktu masih tersisa.</p>
      <p class="p-0 m-0"><i class="bi bi-check-circle"></i> Anda tidak diwajibkan mengisi data peserta.</p>
      
      <div class="mt-5 mb-3 d-flex gap-2">
        <button id="mainActionBtn" class="btn btn-primary flex-grow-1">
          <i class="bi ${mainButtonIcon} me-2"></i> ${mainButtonText}
        </button>
        ${hasPreviousResults || currentQuizActive ? `
          <button id="resetQuizBtn" class="btn btn-outline-danger">
            <i class="bi bi-arrow-counterclockwise"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.RESET}
          </button>
        ` : ''}
      </div>

    </div>
  `;
}

function QuizContainer() {
  return `
    <div id="quizContainer" class="quiz-container">
        <div class="card h-100">
            <div class="card-body">
             <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
               <li class="breadcrumb-item"><a href="${QUIZ_CONFIG.HOMEPAGE_URL}">${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.BERANDA}</a></li>
               <li class="breadcrumb-item active text-truncate" aria-current="page">${QUIZ_CONFIG.QUIZ_TITLE}</li>
              </ol>
             </nav>
                <div id="questionHeader" class="mb-4">
                    <h4>${QUIZ_CONFIG.QUIZ_TITLE}</h4>
                    <div class="d-flex justify-content-between mb-3 mt-3">
                        <span id="timer"></span>
                        <button class="btn btn-sm btn-light d-none" onclick="showUniversalModal('help')">
                            <i class="bi bi-info-circle"></i> Info
                        </button>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-3">
                        <span>
                            Soal <span id="currentQuestionNumber" class="badge text-bg-primary">1</span> / <strong id="totalQuestions">${questions.length}</strong>
                        </span>
                            <span id="questionPoints">(Nilai: 1 Poin)</span>
                    </div>
                    
                    <div class="progress mb-4 mt-3 bg-primary-subtle">
                        <div id="quizProgress" class="progress-bar bg-primary" 
                            role="progressbar" aria-valuenow="0" aria-valuemin="0" 
                            aria-valuemax="100" style="width: 0%">
                        </div>
                    </div>
                </div>

                <h5 id="questionText" class="mb-4 card card-body bg-light"></h5>
                <form id="optionsForm" class="mt-3 mb-4"></form>

                <div class="d-flex justify-content-between mb-3">
                    <button id="prevBtn" class="btn btn-outline-primary">
                        <i class="bi bi-chevron-left"></i> Sebelumnya
                    </button>
                    <div>
                        <button id="finishBtn" class="btn btn-primary d-none">Selesai</button>
                        <button id="nextBtn" class="btn btn-outline-primary">
                            Selanjutnya <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="d-flex justify-content-end gap-2">
                    <button id="giveUpBtn" class="btn btn-outline-danger btn-sm">
                        Menyerah
                    </button>
                    <button id="skipBtn" class="btn btn-outline-secondary btn-sm">
                        Lewati Soal
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card-footer" id="navigasiSoal">
            <div class="mb-5 mt-5" id="questionNumbers"></div>
            <p>
                <button class="btn btn-sm btn-success question-number-info rounded-circle"></button> Soal dijawab
                <button class="btn btn-sm btn-danger rounded-circle question-number-info"></button> Soal dilewati
                <button class="btn btn-sm btn-outline-secondary rounded-circle question-number-info"></button> Soal belum dijawab
                <button class="btn btn-sm btn-primary rounded-circle question-number-info"></button> Halaman/Soal saat ini
            </p>
        </div>
    </div>
  `;
}

function setupQuizEventListeners() {
    // Navigation buttons
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.PREV_BTN)?.addEventListener('click', showPreviousQuestion);
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.NEXT_BTN)?.addEventListener('click', showNextQuestion);
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.SKIP_BTN)?.addEventListener('click', skipQuestion);
    
    // Finish button
    document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.FINISH_BTN)?.addEventListener('click', function() {
        showUniversalModal('finish');
    });
    
    // Give up button
    const giveUpBtn = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.GIVE_UP_BTN);
    if (giveUpBtn) {
        giveUpBtn.onclick = function() {
            showUniversalModal('give-up');
        };
    }
}

function updateURL() {
    const params = new URLSearchParams(window.location.search);
    params.set('soal', currentQuestionIndex + 1);
    params.delete('view');
    const newUrl = window.location.pathname + '?' + params.toString();
    window.history.replaceState({}, '', newUrl);
}

// getActiveQuizSession function
function getActiveQuizSessions() {
    const activeSessions = [];
    
    for (const [quizId, config] of Object.entries(QUIZ_CONFIGS)) {
        try {
            const endTime = localStorage.getItem(`${config.STORAGE_KEY}_${config.KEYS.END_TIME}`);
            const results = localStorage.getItem(`${config.STORAGE_KEY}_${config.KEYS.RESULTS}`);
            
            if (endTime && !results) {
                const remainingTime = parseInt(endTime) - Date.now();
                if (remainingTime > 0) {
                    activeSessions.push({
                        quizId,
                        storageKey: config.STORAGE_KEY,
                        config,
                        remainingTime,
                        endTime: parseInt(endTime),
                        currentQuestion: parseInt(localStorage.getItem(`${config.STORAGE_KEY}_${config.KEYS.CURRENT_QUESTION}`)) || 0,
                        quizTitle: config.QUIZ_TITLE,
                        quizUrl: `/pelatihan/modul/?id=${quizId}`
                    });
                }
            }
        } catch (e) {
            console.error("Error checking quiz session:", e);
        }
    }
    return activeSessions;
}

function updateActiveQuizTimer(endTime) {
    const timerElement = document.getElementById('activeQuizTimer');
    if (!timerElement) return;

    // Convert endTime to number if it's a string
    endTime = typeof endTime === 'string' ? parseInt(endTime) : endTime;

    const updateTimer = () => {
        const now = Date.now();
        const remainingTime = Math.max(0, endTime - now);
        
        // Format the remaining time
        const totalSeconds = Math.floor(remainingTime / 1000);
        const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
        const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
        const seconds = String(totalSeconds % 60).padStart(2, '0');
        
        // Update the timer display
        if (timerElement) {
            timerElement.textContent = `${hours}:${minutes}:${seconds}`;
        }

        // If time has expired, stop the timer
        if (remainingTime <= 0) {
            clearInterval(timerInterval);
            if (timerElement) {
                timerElement.textContent = "00:00:00";
                timerElement.closest('.alert')?.classList.add('bg-danger');
            }
        }
    };

    // Update immediately and then every second
    updateTimer();
    const timerInterval = setInterval(updateTimer, 1000);

    // Clean up when the page unloads
    window.addEventListener('beforeunload', () => {
        clearInterval(timerInterval);
    });
}

function updateQuizTimer(element, endTime) {
  const update = () => {
    const remaining = endTime - Date.now();
    if (remaining <= 0) {
      element.textContent = "00:00:00";
      element.classList.add('text-danger');
      clearInterval(element.timerInterval);
      return;
    }
    
    const totalSeconds = Math.floor(remaining / 1000);
    const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
    const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
    const seconds = String(totalSeconds % 60).padStart(2, '0');
    
    element.textContent = `${hours}:${minutes}:${seconds}`;
  };
  
  // Clear previous interval
  if (element.timerInterval) {
    clearInterval(element.timerInterval);
  }
  
  update();
  element.timerInterval = setInterval(update, 1000);
}

function setupNotificationEventListeners() {
  // Continue quiz button
  document.querySelectorAll('.continue-quiz-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const quizId = this.dataset.quizId;
      const questionNum = this.dataset.question;
      window.location.href = `/pelatihan/modul/?id=${quizId}&soal=${questionNum}`;
    });
  });
  
  // Abandon quiz button
  document.querySelectorAll('.abandon-quiz-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const quizId = this.dataset.quizId;
      showAbandonQuizModal(quizId);
    });
  });
}

function showAbandonQuizModal(quizId) {
  const config = QUIZ_CONFIGS[quizId];
  
  document.getElementById('universalModalTitle').textContent = 'Batalkan Quiz';
  document.getElementById('universalModalBody').innerHTML = `
    <p>Anda yakin ingin membatalkan quiz <strong>${config.QUIZ_TITLE}</strong>?</p>
    <div class="alert alert-danger">
      <i class="bi bi-exclamation-triangle"></i> Semua progress akan dihapus permanen!
    </div>
  `;
  
  const confirmBtn = document.getElementById('universalModalConfirmBtn');
  confirmBtn.className = 'btn btn-danger';
  confirmBtn.innerHTML = '<i class="bi bi-trash"></i> Ya, Batalkan';
  confirmBtn.onclick = function() {
    abandonQuiz(quizId);
    universalModal.hide();
  };
  
  universalModal.show();
}

function abandonQuiz(quizId) {
  const config = QUIZ_CONFIGS[quizId];
  Object.values(config.KEYS).forEach(key => {
    localStorage.removeItem(`${config.STORAGE_KEY}_${key}`);
  });
  
  showAlert('Quiz telah dibatalkan', 'success');
  displayActiveQuizzes(); // Refresh the list
}

function showNotificationsPage() {
  // Hide all other containers
  document.querySelectorAll('#mainContainer > div').forEach(div => {
    div.style.display = 'none';
  });
  
  // Show notifications container
  const notificationsContainer = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_IDS.NOTIFICATIONS_CONTAINER);
  notificationsContainer.style.display = 'block';
  
  // Display active quizzes
  displayActiveQuizzes();
}

function displayActiveQuizzes() {
  const activeQuizzesList = document.getElementById(COMMON_QUIZ_CONFIG.ELEMENT_TEXT.ACTIVE_QUIZZESS_LIST);
  const activeSessions = getAllActiveSessions();
  document.title = "Notifikasi";

  if (!activeQuizzesList) return;
  
  if (activeSessions.length === 0) {
    activeQuizzesList.innerHTML = `
      <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.NO_NOTIFICATION}
      </div>
    `;
    return;
  }
  
  // Add info about number of active quizzes
  const activeCount = activeSessions.length;
  const infoText = `Anda memiliki ${activeCount} kuis berjalan`;
  
  activeQuizzesList.innerHTML = `
    <div class="alert alert-info mb-3">
      <i class="bi bi-info-circle"></i> ${infoText}
    </div>
    ${activeSessions.map(session => `
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">${session.quizTitle}</h5>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Status:</span>
            <span class="badge bg-warning text-dark">Dalam Progres</span>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Waktu tersisa:</span>
            <span class="badge bg-danger" id="sessionTimer-${session.quizId}">
              ${formatTime(session.remainingTime / 1000)}
            </span>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Soal saat ini:</span>
            <span class="badge bg-primary">${session.currentQuestion + 1}/${session.config.QUESTION_COUNT}</span>
          </div>
          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-primary btn-sm continue-quiz-btn" 
                    data-quiz-id="${session.quizId}" 
                    data-question="${session.currentQuestion + 1}">
              <i class="bi bi-arrow-return-right"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.LANJUTKAN_KUIS}
            </button>
            <button class="btn btn-outline-danger btn-sm abandon-quiz-btn" 
                    data-quiz-id="${session.quizId}">
              <i class="bi bi-x-circle"></i> ${COMMON_QUIZ_CONFIG.ELEMENT_TEXT.BATALKAN_KUIS}
            </button>
          </div>
        </div>
      </div>
    `).join('')}
  `;
  
  // Start timers for each active session
  activeSessions.forEach(session => {
    const timerElement = document.getElementById(`sessionTimer-${session.quizId}`);
    if (timerElement) {
      updateQuizTimer(timerElement, session.endTime);
    }
  });
  
  // Setup event listeners for the buttons
  setupNotificationEventListeners();
}

// Initialize
document.addEventListener('click', function(e) {
    if (e.target.closest('.continue-quiz-btn')) {
        e.preventDefault();
        const btn = e.target.closest('.continue-quiz-btn');
        const quizId = btn.getAttribute('data-quiz-id');
        const questionNum = btn.getAttribute('data-question');
        
        // Force reload with the correct URL
        window.location.href = `/pelatihan/modul/?id=${quizId}&soal=${questionNum}`;
    }
});
document.addEventListener('DOMContentLoaded', function() {
    handleUrlParameters();
    updateActiveQuizzesBadge();
    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
        new bootstrap.Tooltip(el);
    });
});

// Handle PWA installation
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
    // Prevent the mini-infobar from appearing on mobile
    e.preventDefault();
    // Stash the event so it can be triggered later
    deferredPrompt = e;
    // Show the install button
    document.getElementById('installContainer').style.display = 'block';
});

document.getElementById('installBtn').addEventListener('click', async () => {
    if (!deferredPrompt) return;
    
    // Show the install prompt
    deferredPrompt.prompt();
    
    // Wait for the user to respond to the prompt
    const { outcome } = await deferredPrompt.userChoice;
    
    // Optionally, send analytics event with outcome of user choice
    console.log(`User response to the install prompt: ${outcome}`);
    
    // We've used the prompt, and can't use it again, throw it away
    deferredPrompt = null;
    
    // Hide the install button
    document.getElementById('installContainer').style.display = 'none';
});

window.addEventListener('appinstalled', () => {
    // Hide the install button
    document.getElementById('installContainer').style.display = 'none';
    // Clear the deferredPrompt so it can be garbage collected
    deferredPrompt = null;
    // Optionally, send analytics event to indicate successful install
    console.log('PWA was installed');
});
</script>
</body>
</html>
